(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{157:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(10),a=n.n(r),o=n(40),i=n.n(o),s=n(32),c=n.n(s),u=n(11),d=n.n(u),l=n(41),p=n.n(l),h=n(42),f=n.n(h),v=n(1),b=function(e){function t(e,n,r,o,s){var u,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6?arguments[6]:void 0;a()(this,t),(u=i()(this,c()(t).call(this))).title=e,u.body=n,u.bodyOnClick=r,u.action1=o,u.action1onClick=s||{},u.input=d;var p=u.createTemplate(),h=u.attachShadow({mode:"open"});if(h.appendChild(p.content.cloneNode(!0)),h.querySelector(".body").onclick=function(){r()},u.action1onClick.showInput){var f,b=h.querySelector(".action");u.input&&(f=v.a.create("input",{id:"input"})),f.onkeydown=function(e){if(13===e.keyCode)return f.replaceWith(b),l(e),u.remove()},b.onclick=function(){b.replaceWith(f),f.focus(),clearTimeout(u.$$timer)}}else h.querySelector(".action").onclick=function(e){return s(e)};return u}return p()(t,e),d()(t,[{key:"createTemplate",value:function(){var e=v.a.create("div",{class:"bxcs"}),t=v.a.create("div",{class:"__div",textContent:this.title}),n=v.a.create("div",{textContent:this.body,class:"body"}),r=v.a.create("button",{class:"action",textContent:this.action1}),a=v.a.create("div");e.appendChild(t),e.appendChild(n),e.appendChild(a),a.appendChild(r);var o=v.a.create("template");return o.innerHTML=e.outerHTML+"<style>".concat(".action{cursor:pointer}.__div{font-weight:bold}.action,.bxcs{background-color:#fff}input{width:90%;border-radius:20px;border:2px solid #e3e3e3;padding:4px;outline:0}.bxcs{position:fixed;width:85%;margin:auto;right:0;left:0;top:2px;border-radius:10px;height:auto;padding:10px;z-index:20;box-shadow:0 2px 8px 0 #04040426}.action{color:#4749e4;font-weight:700;border:none;outline:0}","</style>"),o}},{key:"startTick",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4e3;this.$$timer=setTimeout((function(){return e.remove()}),t)}}]),t}(f()(HTMLElement));Object(v.l)("mat-notify",b)},158:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(0),a=n.n(r),o=(n(23),n(2)),i=n.n(o),s=n(1),c=n(157),u=n(39),d=function(e){if(Object(s.k)(location.href).path==="/chat/".concat(e.chat_id))console.log("not showing notification for current chat");else{var t;t=e.message&&e.message.media?"media message":e.message;var n=new c.a(e.sender,t,(function(){return Object(s.i)("/chat/".concat(e.chat_id))}),"reply",{showInput:!0},!0,function(){var t=i()(a.a.mark((function t(n){var r,o,i,c,d;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.target.value,(o=Object(u.d)()).isUsable&&o.socket){t.next=5;break}return t.next=5,o.startConn("_/data/");case 5:return i=Object(s.c)(),t.next=8,u.h.getUser(!1,!0);case 8:c=t.sent,d={details:{chat_id:e.chat_id,data:{sender:c,receiver:e.sender,message:r,stamp:i}}},u.b.post("/api/instant-message/",!0,JSON.stringify(d),{"content-type":"application/json"}),o.send({type:"message-relay",peer:e.sender,sender:c,data:{peer:e.sender,sender:c,type:"message-relay",data:{stamp:i,message:r,chat_id:e.chat_id,peer:e.sender}}});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());document.body.appendChild(n),n.startTick(2e3)}}},163:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=(n(106),n(76),n(56),n(75),n(23),n(2)),i=n.n(o),s=n(39),c=n(1),u=n(158);if(window.Notification){if("undefined"==typeof firebase)throw new Error("hosting/init-error: Firebase SDK not detected. You must include it before /__/firebase/init.js");firebase.initializeApp({apiKey:"AIzaSyCrdjBktQNWizVmfjK50I7BGsIQcNFmKcI",databaseURL:"https://webmsg-py.firebaseio.com",storageBucket:"webmsg-py.appspot.com",authDomain:"webmsg-py.firebaseapp.com",messagingSenderId:"193257233140",projectId:"webmsg-py"})}function d(){return l.apply(this,arguments)}function l(){return(l=i()(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof window.Notification){e.next=20;break}return t=firebase.messaging(),e.prev=2,console.log("Supports Notifications"),t.usePublicVapidKey("BGhv7XYjPBkpVoOEPbq2E19Is1ti_MYfboTDazKE0jgxPENxDqe0-U2p1OKEEgG4JH4Ycl8Wbxdv-UrrP_LcLmw"),e.next=7,t.requestPermission();case 7:return e.next=9,t.getToken();case 9:return n=function(){var e=i()(a.a.mark((function e(){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getToken();case 2:return n=e.sent,console.log("Token refreshed:"),console.log(n),e.next=7,s.b.post("/api/set-notification-token/",!0,Object(c.o)({token:n}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=12,n();case 12:t.onTokenRefresh(n),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),console.warn(e.t0),console.log("Permission-Denied");case 19:"granted"===Notification.permission&&(console.log("Granted Notification Perm"),t.onMessage(function(){var e=i()(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=JSON.parse(t.data.data),Object(u.a)(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:case"end":return e.stop()}}),e,null,[[2,15]])})))).apply(this,arguments)}var p=n(10),h=n.n(p),f=n(40),v=n.n(f),b=n(32),m=n.n(b),x=n(11),k=n.n(x),g=n(41),y=n.n(g),w=n(42),C=function(e){function t(e,n){var r;h()(this,t);var a=(r=v()(this,m()(t).call(this)))._createTemplate();return r.attachShadow({mode:"open"}).appendChild(a.content.cloneNode(!0)),r.button=r.shadowRoot.querySelector("button"),r.box=r.shadowRoot.querySelector("div"),r.box.addEventListener("click",(function(e){return e.stopImmediatePropagation(),r.checked?r.checked=!1:r.checked=!0})),e&&(r.box.style=e),n&&(r.button.style=n),r}return y()(t,e),k()(t,[{key:"attributeChangedCallback",value:function(e,t,n){var r;return"checked"===e?(r="false"!==n&&"0"!==n,"checked"===e?this.checked=r:void 0):"boxstyle"===e?this.boxtyle=n:"buttonstyle"===e?this.buttonstyle=n:void 0}},{key:"_createTemplate",value:function(){var e=document.createElement("div"),t=document.createElement("button");e.appendChild(t);var n=document.createElement("template"),r=document.createElement("style");return r.innerHTML="div{-webkit-tap-highlight-color:transparent;background-color:#fff;cursor:pointer;border-radius:100px;height:20px;width:50px;display:inline-flex;border:2px solid #e3e3e3}button{box-shadow:0 1px 5px 0 #0009;display:block;margin-top:auto;margin-bottom:auto;height:inherit;border-radius:100%;border:none;width:20px;transition:all .2s ease-in-out 0s;cursor:pointer;outline:0}button.clicked{margin-left:30px;background-color:#033577}",n.innerHTML=r.outerHTML+e.outerHTML,n}},{key:"checked",set:function(e){var t=this.button;this._checked=!!e,e?t.classList.add("clicked"):t.classList.remove("clicked");var n=new Event("check");n.checked=this.checked,this.dispatchEvent(n)},get:function(){return this._checked}},{key:"oncheck",set:function(e){this.eventListener=e,this.addEventListener("check",e)}},{key:"boxtyle",set:function(e){return this.box.style=e}},{key:"buttonstyle",set:function(e){return this.button.style=e}}],[{key:"observedAttributes",get:function(){return["checked","boxstyle","buttonstyle"]}}]),t}(n.n(w)()(HTMLElement));Object(c.l)("mat-checkbox",C);var j,_=function(e,t){return{element:"button",children:[{element:"a",textContent:e,attrs:{href:"#/chat/".concat(t),class:"result_name"}}],events:{click:function(e){return Object(c.i)("/chat/".concat(t)),e.preventDefault()}},attrs:{class:"searchresult"}}};function O(e){var t=Object(c.e)(this,"prevChatsData"),n=Object(c.e)(this,"prevChatsMessage");this.attrs._checked=e.checked;var r=Object(c.e)(this,"loading-spinner");function o(){return(o=i()(a.a.mark((function e(){var o,i,u,d,l,p,h,f,v,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.remove(),n.remove(),r.add(),!navigator.onLine){e.next=18;break}return e.t0=s.b,e.t1=c.o,e.next=8,s.h.getUser(!1,!0);case 8:return e.t2=e.sent,e.t3={user:e.t2},e.t4=(0,e.t1)(e.t3),e.next=13,e.t0.post.call(e.t0,"/api/chat_ids/",!0,e.t4);case 13:return i=e.sent,e.next=16,i.json();case 16:(o=e.sent).previous_chats&&localStorage.setItem("previous_chats",JSON.stringify(o.previous_chats));case 18:if((u=(o||{}).previous_chats||[]).length){e.next=23;break}return r.remove(),n.$$element.textContent="An error occured while searching for your chats",e.abrupt("return");case 23:for(d=[],l=!0,p=!1,h=void 0,e.prev=27,f=u[Symbol.iterator]();!(l=(v=f.next()).done);l=!0)b=v.value,d.push(_(b.user,b.chat_id));e.next=35;break;case 31:e.prev=31,e.t5=e.catch(27),p=!0,h=e.t5;case 35:e.prev=35,e.prev=36,l||null==f.return||f.return();case 38:if(e.prev=38,!p){e.next=41;break}throw h;case 41:return e.finish(38);case 42:return e.finish(35);case 43:t.children=d,t.safeRerender(t),r.remove(),this.add(),n.add(),n.attrs.textContent="Your Previous Chats",n.update();case 50:case"end":return e.stop()}}),e,this,[[27,31,35,43],[36,,38,42]])})))).apply(this,arguments)}e.checked?function(){return o.apply(this,arguments)}.call(this):(n.attrs.textContent="Click to show your previous chats",n.update(),t.remove())}var T,E,S,L={element:"div",attrs:{},children:[Object(s.e)("searchHint","Search for users","userSearch",{keydown:(j=i()(a.a.mark((function e(t){var n,r,o,i,u,d,l,p,h,f,v,b,m,x,k,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(85!==t.keyCode||!t.ctrlKey){e.next=4;break}return t.preventDefault(),this.$$element.value="",e.abrupt("return");case 4:if(13!==t.keyCode){e.next=57;break}if((n=Object(c.e)(this,"resultBox")).attrs.textContent="",n.update(),n.children=[],n.reRender(),!(r=(this.attrs.value||"").trim())){e.next=57;break}return(o=Object(c.e)(this,"search-spinner")).add(),e.next=16,s.h.getIntegrity();case 16:return i=e.sent,e.next=19,s.b.get("/api/user-search/tokens/".concat(i));case 19:return u=e.sent,e.next=22,u.text();case 22:return d=e.sent,e.next=25,s.b.post("/api/users/",!0,Object(c.o)({token:d,user:r}));case 25:return l=e.sent,e.next=28,l.json();case 28:if(p=e.sent,(h=p.users||[]).length){e.next=34;break}return n.attrs.textContent="No Users Found",n.update(),e.abrupt("return",o.remove());case 34:for(f=[],v=!0,b=!1,m=void 0,e.prev=38,x=h[Symbol.iterator]();!(v=(k=x.next()).done);v=!0)g=k.value,f.push(_(g.user,g.chat_id));e.next=46;break;case 42:e.prev=42,e.t0=e.catch(38),b=!0,m=e.t0;case 46:e.prev=46,e.prev=47,v||null==x.return||x.return();case 49:if(e.prev=49,!b){e.next=52;break}throw m;case 52:return e.finish(49);case 53:return e.finish(46);case 54:n.children=f,o.remove(),n.reRender(n);case 57:case"end":return e.stop()}}),e,this,[[38,42,46,54],[47,,49,53]])}))),function(e){return j.apply(this,arguments)})}),{idx:"search-spinner",element:"mat-spinner",attrs:{svgstyle:"margin:auto;margin-top:10px"},onrender:function(){this.remove()}},{element:"div",attrs:{},idx:"resultBox",children:[]}]},N={idx:"prevChatsUI",element:"div",attrs:{style:{width:"80%",margin:"auto","border-top":"1px solid #000","margin-top":"10px"}},onrender:(E=i()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return E.apply(this,arguments)}),children:[{attrs:{boxstyle:Object(c.j)({"margin-top":"20px"})},element:"mat-checkbox",events:{check:(T=i()(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(s.g)((function(){return O.call(n,t)}),1,(function(e){console.log(e),Object(c.e)(n,"loading-spinner").remove();var t=Object(c.e)(n,"prevChatsMessage");return t.attrs.textContent="Could not find previus chats",t.update(),n.remove()}));case 1:case"end":return e.stop()}}),e)}))),function(e){return T.apply(this,arguments)})}},{idx:"prevChatsMessage",element:"div",textContent:"Click to show your previous chats"},{idx:"loading-spinner",element:"mat-spinner",attrs:{svgstyle:"margin:auto"},onrender:function(){this.remove()}},{idx:"prevChatsData",element:"div",onrender:function(){this.remove()}}]};t.default={element:"div",route:"/u/",attrs:{},beforeRender:(S=i()(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.a.empty(this.getRouter().root),!(n=Object(s.f)(this.currentRoute,this.getRouter().navData))){e.next=4;break}return e.abrupt("return",n);case 4:if((r=t[0])&&r===user){e.next=7;break}return e.abrupt("return",(Object(c.i)("/u/".concat(user)),{stopExec:!0}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)}),onrender:function(){return function(){if("function"==typeof Notification){if("default"===Notification.permission){var e=c.a.create("div",{notification:!0,textContent:"Click to enable notification service. Long press or right click to remove this dialog",_routerif:"this.routeParser(location).includes('/u/')",events:{contextmenu:function(e){e.target.remove()}}});return document.body.appendChild(e),e.style.transform="translate(0px,0px)",e.onclick=function(){e.remove(),d()}}d()}}(),document.documentElement.style.backgroundColor=document.body.style.backgroundColor="#ffffff"},onUnmount:function(){return document.documentElement.style.backgroundColor=document.body.style.backgroundColor="#e3e3e3"},children:[L,N]}}}]);