!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=5)}([function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTYuNSA2djExLjVjMCAyLjIxLTEuNzkgNC00IDRzLTQtMS43OS00LTRWNWMwLTEuMzggMS4xMi0yLjUgMi41LTIuNXMyLjUgMS4xMiAyLjUgMi41djEwLjVjMCAuNTUtLjQ1IDEtMSAxcy0xLS40NS0xLTFWNkgxMHY5LjVjMCAxLjM4IDEuMTIgMi41IDIuNSAyLjVzMi41LTEuMTIgMi41LTIuNVY1YzAtMi4yMS0xLjc5LTQtNC00UzcgMi43OSA3IDV2MTIuNWMwIDMuMDQgMi40NiA1LjUgNS41IDUuNXM1LjUtMi40NiA1LjUtNS41VjZoLTEuNXoiLz48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PC9zdmc+Cg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZwogIHdpZHRoPSI0MCIKICBoZWlnaHQ9IjQwIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICB2aWV3Qm94PSIwIDAgMjQgMjQiCj4KICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIj48L3BhdGg+CiAgPHBhdGgKICAgIGQ9Ik0xMiA4YzEuMSAwIDItLjkgMi0ycy0uOS0yLTItMi0yIC45LTIgMiAuOSAyIDIgMnptMCAyYy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnptMCA2Yy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnoiCiAgPjwvcGF0aD4KPC9zdmc+Cg=="},function(e,t,s){},function(e,t,s){},function(e){e.exports={}},function(e,t,s){"use strict";s.r(t);const n=e=>e.constructor===Object,r=e=>{if("string"==typeof e)return"/"===e[0]?location.hash=e:location.hash=`/${e}`},i=new class{emit(e,t){return window.dispatchEvent(new CustomEvent(e,{detail:t}))}listen(e,t){return this.EventCache[e]=t,window.addEventListener(e,t)}detroyEvt(e,t){window.removeEventListener(e,t)}destroyAll(){for(const e of Object.keys(this.EventCache))this.detroyEvt(e,this.EventCache[e])}constructor(){this.EventCache={}}},o=e=>{let t,s;if("#"===e[0])t=e.substr(1);else try{t=(s=new URL(e)).hash.substr(1)}catch(e){t="/",console.log(e)}const n=t.split("?"),[r,i]=[0===t.length?"/":n[0],n[1]];return{path:r,qs:i}},a=(e=15)=>[...Array(e)].join(".").replace(/[.]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),c=(()=>{const e=document.createElement("style");return e.innerHTML="",document.head.appendChild(e),e.sheet})(),l=(e,t=c)=>{return Array.from(t.rules).filter(t=>t.selectorText===e)[0]},d=(e,t,s=c)=>{const r=Object.keys(t);for(const i of r)if(!["$$element","$$parent"].includes(i)){const r=t[i];if("class"===i)e.className="string"==typeof r?r:[...r].join(" ");else if("events"===i)for(const t of r){const s=r[t];e.addEventListener(t,s)}else if("style"===i){let i,o,c;if(i=n(r)?m(r):r,c=e.getAttribute("_routercontent")||t._routercontent){const e=l(`[_routercontent="${c}"]`);e?e.style=i:o=!0}else c=a(),o=!0;o&&(e.setAttribute("_routercontent",c),s.insertRule(`[_routercontent='${c}']{${i}}`))}else["___innerHTML___","innerText","textContent"].includes(i)?"___innerHTML___"===i?e.innerHTML=r:e.textContent=r:e.setAttribute(i,r)}},h={q:(e,t=!0)=>t?document.querySelector(e):Array.from(document.querySelectorAll(e)),id:e=>document.getElementById(e),className:(e,t=!0)=>{const s=Array.from(document.getElementsByClassName(e));return t?s[0]:s},create:(e,t,s=c)=>{const n=document.createElement(e);return t&&"object"==typeof t&&d(n,t,s),n},get:(e,t)=>e.getAttribute(t),set:(e,t,s)=>e.setAttribute(t,s),empty:e=>{let t;for(t=e.lastChild;t;)e.removeChild(t),t=e.lastChild}},u=e=>e instanceof Function,p=e=>"AsyncFunction"===e.constructor.name,m=e=>{if("string"==typeof e)return e;const t=[];for(const s of Object.keys(e))t.push(`${s}:${e[s]}`);return t.join(";")},g=e=>window.URLSearchParams?new URLSearchParams(e):`${Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}`;const _=e=>{try{const t={hour:"numeric",hour12:!0,minute:"numeric"},s=new Date(e),n=new Date;if(s.getFullYear()!==n.getFullYear()&&(t.year="numeric"),function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}(s,n)||(t.month=t.day="numeric"),s.getMonth())return Intl.DateTimeFormat("auto",t).format(s)}catch(t){return console.log(t),new Date(e).toLocaleString()}},f=()=>(new Date).getTime(),y=(e,t)=>{if(e){const s=e.routeCache();return s?s[t]:null}return null};function v(e,t){if(!window.customElements.get(e))return window.customElements.define(e,t)}h.q("noscript").remove();const w={element:"a",attrs:{href:"/#/",style:{display:"block",color:"#000"}},events:{click(e){e.preventDefault(),location.hash="/"}},textContent:"Click Here to Go Back",children:[]},x={display:"block","text-align":"center","font-family":"sans-serif",padding:"8px",margin:"auto","font-weight":"bold"},C=new class{parseHash(e){return o(e)}async __runConditionals(){const e=[...document.querySelectorAll("[_routerif]")];for(const t of e){const e=h.get(t,"_routerif"),s=h.get(t,"_routerthen");if(new Function("$",`return ${e}`).call(this,t)){const e=t.$;e&&(t.replaceWith(e),s&&new Function("$",s).call(this,e))}else{if(t.$ instanceof HTMLElement)continue;const n={_routerif:e};s&&(n._routerthen=s);const r=h.create("router-data",n);r.$=t,t.replaceWith(r)}}}async __runEventListeners(){const e=h.q("[_routerEvt][_routerAct]",!1);for(const t of e){const e=h.get(t,"_routerEvt"),s=h.get(t,"_routerAct");t[e]=(()=>{new Function(s).call(this)})}}async _runDirectives(){await this.__runConditionals(),this.__runEventListeners()}_callFuncWithThis(e,t,s,n){if(p(e))return e.apply(t,[n]).then(e=>(s&&(e||{}).stopUpdate&&d(s,t.attrs),e));{const r=e.apply(t,[n]);return s&&((r||{}).stopUpdate||d(s,t.attrs)),r}}_setVars(e){this.stopSubsequentRenders=!1,this.root=e,this.routeMap={},this.routes=[],this.routeCache={},this.unMountFn=(()=>{}),this.unmountRoute=(()=>{this.unMountFn(),this.routeCache={}}),this.statusHandler={404:{element:"div",attrs:{style:x},textContent:"The Page you are requesting was not found",children:[w]},500:{element:"div",attrs:{style:x},textContent:"An Error Occured while trying to process your request",children:[w]}}}constructor(e=window.$ROOT||h.id("app-root")||h.q("body")){this._setVars(e),window.onhashchange=(e=>(this.navData=e,this.routeChange(),this._runDirectives())),this._runDirectives()}isUserGoingBack(e){const t=this.navData||{};return!(`${location.protocol}//${location.host}/#${e}`!=t.oldURL||(console.log("Same url navigation"),0))}routeParser(e){const{path:t}=this.parseHash(e);return t}load(e){return r(e)}lazyload(e,t,s){s?this.registerRoute(s):this.registerRoute({route:e,element:"div",textContent:"loading",attrs:{style:{margin:"100px"}}});const n=this.getRouteName(this.currentRoute)===e;return n&&this.startLoad(),t.then(e=>{if(this.registerRoute(e.default),n)return this.startLoad()})}get currentQS(){const{qs:e}=this.parseHash(location.hash);return e}get currentRoute(){return this.routeParser(location.href)}startLoad(){this.routeChange()}pushStatus(e,t){const s=this.statusHandler[e];return s.textContent=t||s.textContent,s?this.render(s,this.root,!0):this.render(this.statusHandler[404])}getRouteName(e){const t=e.split("/").filter(e=>e)[0];return t?`/${t}/`:"/"}isValidRoute(e){if(this.routes.includes(e))return{res:!0,args:null,_fRoute:e};try{const t=e.split("/").filter(e=>e),s=`/${t[0]}/`;return this.routes.includes(s)?{res:!0,args:t.slice(1),_fRoute:s}:{res:!1}}catch(e){return console.log(e),{res:!1}}}routeChange(){const e=this.routeParser(location.href),{res:t,args:s,_fRoute:n}=this.isValidRoute(e);t?(console.log("rendering"),this.render(this.routeMap[n],this.root,!0,s)):this.render(this.statusHandler[404],this.root,!0,s)}__toSets(e){"string"==typeof e.attrs.class?e.attrs.class=new Set([e.attrs.class]):Array.isArray(e.attrs.class)&&(e.attrs.class=new Set(e.attrs.class))}__objDef(e,t,s,n,r){const i=()=>e.$$element;e.attrs=e.attrs||{},this.__toSets(e),e.getRouter=(()=>this),e.update=(()=>{if(i()&&e.attrs)return d(i(),e.attrs)}),e.remove=(()=>{if(i().parentNode)return i().replaceWith((()=>{const t=h.create("router-data");return e._$routerData=t,t})())}),e.add=((t="block")=>{e._$routerData&&(e._$routerData.replaceWith(i()),e._$routerData=void 0),t&&(i().style.display=t)}),e.routeCache=(()=>this.routeCache),e.reRender=(async(o=e)=>(e.attrs._routercontent=i().getAttribute("_routercontent"),i().replaceWith(await this.render(o,t,s,n,r)))),e.safeRerender=(t=>{e.add(),e.reRender(t),e.add()})}async render(e,t,s=!1,n,r){if(this.stopSubsequentRenders)return void console.log("preventing render");if(!e)return;const i=n||[];this._runDirectives();const{element:o,attrs:a,beforeRender:c,onrender:l,textContent:d,_innerHTML:m,onUnmount:g,events:_,children:f,isRoute:y}=e;if(this.__objDef(e,t,s,i,r),(y||s)&&this.unmountRoute(),u(c)){let t;if((t=p(c)?await this._callFuncWithThis(c,e,null,i):this._callFuncWithThis(c,e,null,i))&&t.stopExec)return}const v=h.create(o,a),w={};e.idx&&(w[e.idx]=e),Object.assign(this.routeCache,function(e){if(!e)return{};const t={};for(const s of e)s.idx&&(t[s.idx]=s);return t}(f),w),e.$$element=v,e.$$parent=r||null,d||0===d?v.textContent=d:m&&(console.warn("innerHTML can be dangerous!"),v.innerHTML=m);for(const t of Object.keys(_||{}))v.addEventListener(t,s=>this._callFuncWithThis(_[t],e,v,s));for(const t of f||[])this.render(t,v,!1,null,e);return s&&h.empty(t),t.appendChild(v),y&&(this.unMountFn=g||(()=>{})),u(l)&&(p(l)?await this._callFuncWithThis(l,e,v,i):this._callFuncWithThis(l,e,v,i)),v}registerRoute(e,t=!1){if(!(e.route&&e.element&&"/"===e.route[0]||t))throw new Error("invalid values");if(!t){this.routes.includes(e.route)||this.routes.push(e.route);const{element:t,children:s,selector:n,attrs:r,beforeRender:i,events:o,hasRouteArgs:a,onUnmount:c,onrender:l,route:d,textContent:h,_innerHTML:u}=e,p=e.idx;return this.routeMap[d]={idx:p,element:t,selector:n,beforeRender:i,onrender:l,hasRouteArgs:a,attrs:r,textContent:h,_innerHTML:u,events:o,children:s,onUnmount:c,isRoute:!0}}{const t=e.status;this.statusHandler[t]=e}}};v("router-data",class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).appendChild((()=>Object.assign(document.createElement("style"),{innerHTML:":host{display:none}"}))())}});class b extends HTMLElement{set size(e){const t=this.svg();t.style.height=t.style.width=e}get size(){return this.svg().style.height}set color(e){this.circle().style.stroke=e}get color(){return this.circle().style.stroke}set svgstyle(e){return this.svg().style=e}set circlestyle(e){return this.circle().style=e}static get observedAttributes(){return["size","color","svgstyle","circlestyle"]}attributeChangedCallback(e,t,s){"size"===e?this.size=s:"color"===e?this.color=s:"svgstyle"===e?this.svgstyle=s:"circlestyle"===e&&(this.circlestyle=s)}createTemplate(){const e=h.create("svg",{viewbox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"}),t=h.create("circle",{fill:"none","stroke-width":6,"stroke-linecap":"round",cx:33,cy:33,r:30}),s=document.createElement("template");e.appendChild(t);const n=document.createElement("style");return n.innerHTML="svg{display:inline-block;width: 65px;height: 65px;animation:rotator 1.4s linear infinite}@keyframes rotator{0%{transform:rotate(0)}100%{transform:rotate(270deg)}}circle{stroke:#6f70ee;stroke-dasharray:120;stroke-dashoffset:0;transform-origin:center;animation:dash 1.4s ease-in-out infinite}@keyframes dash{0%{stroke-dashoffset:120}50%{stroke-dasharray:200;stroke-dashoffset:190;transform:rotate(135deg)}100%{stroke-dashoffset:120;transform:rotate(450deg)}}",s.innerHTML=n.outerHTML+e.outerHTML,s}constructor(e,t,s,n){super();const r=this.createTemplate();this.attachShadow({mode:"open"}).appendChild(r.content.cloneNode(!0)),this.svg=(()=>this.shadowRoot.querySelector("svg")),this.circle=(()=>this.shadowRoot.querySelector("circle")),e&&(this.size=e),t&&(this.color=t),s&&(this.svg().style=s),n&&(this.circle().style=n)}}v("mat-spinner",b);const k=window.location.host.includes("localhost")?"localhost:5000":"webmsg.herokuapp.com",$=`${window.location.protocol}//${k}`,M=e=>`${"https:"===window.location.protocol?"wss://":"ws://"}${k}/${e}`;class I{__defaultOnMessage(e){if(["ping","pong"].includes(e.data))return;const t=JSON.parse(e.data);this._socketID=t.socket_id}startConn(e){return new Promise((t,s)=>{this.socket=new WebSocket(M(e)),this.socket.onopen=(()=>{this.socket.send("__init__"),this.socket.onmessage=this.__defaultOnMessage,this._pingPongs(),t(this.socket)}),this.socket.onerror=(e=>s(e))})}close(){try{this.socket.close()}catch(e){console.warn(e)}}send(e){return this.socket.send(JSON.stringify(e))}sendString(e){return this.socket.send(e)}set onmessage(e){this.socket.onmessage=(t=>"ping"===t.data||"pong"===t.data?void 0:e(t))}get readyState(){return this.socket.readyState}get isUsable(){return!this.socket||[WebSocket.OPEN,WebSocket.CONNECTING].includes(this.socket.readyState)}_pingPongs(){this.pingtimer=setTimeout(()=>{this.socket.readyState===this.socket.OPEN?(this.socket.send("ping"),this._pingPongs()):clearTimeout(this.pingtimer)},2e4)}constructor(){}}let E;const S=()=>(E||{}).isUsable?E:E=new I;class T{static async get(e,t=!0,s={}){let n;return n=t?$+e:e,await fetch(n,{headers:s,credentials:"include"})}static async post(e,t=!0,s,n={"content-type":"application/x-www-form-urlencoded"}){let r;return r=t?$+e:e,await fetch(r,{method:"post",body:s,headers:n,credentials:"include"})}}const L=(()=>{const e=(e,t,s,n)=>{const r={};return t.blur||(r.blur=function(){!function(e,t){if(!e.attrs.value||!e.attrs.value.trim()){const s=y(e,t);s.attrs.class.delete("moveup"),s.attrs.class.add("movedown"),s.update(),setTimeout(()=>(s.attrs.class.delete("movedown"),s.update()),110)}}(this,n),this.update()}),t.focus||(r.focus=function(){this.attrs.untouched=!1,function(e,t){const s=y(e,t);s.attrs.class.add("moveup"),s.attrs.class.delete("movedown"),s.update()}(this,n)},t.keydown||(r.keydown=function(e){85===e.keyCode&&e.ctrlKey&&(e.preventDefault(),this.$$element.value=this.$$element.value.slice(this.$$element.selectionStart,this.$$element.value.length),this.$$element.setSelectionRange(0,0))}),t.keyup||(r.keyup=function(){return this.attrs.value=this.$$element.value})),{idx:e,element:"input",attrs:{type:s?"password":"text",spellcheck:!1,class:"paper-input"},onrender(){this.attrs.value?this.$$element.focus():(this.attrs.untouched=!0,this.attrs.clean=!0)},events:{...t,...r}}};return(t,s,n,r,i=!1)=>({element:"div",children:[{idx:t,onrender(){const e=y(this,n);e&&e.$$element&&e.$$element.value.trim()&&(this.attrs.class=new Set(["_animate","moveup"]))},element:"div",textContent:s,attrs:{class:"_animate"}},e(n,r,i,t)]})})(),R=(e,t)=>(console.log(e),t.registerRoute((e=>({element:"div",status:503,textContent:"An error occured while contacting the server..please reload the page and try again",attrs:{style:{margin:"auto","text-align":"center"},class:"_errComponent"},children:[{element:"button",attrs:{style:{background:"#fff",color:"#000",border:"1px solid #6f70ee","border-radius":"20px",display:"block",margin:"auto","margin-top":"20px",padding:"8px",width:"20%",outline:"none",cursor:"pointer"},class:"ripple"},textContent:"Reload",events:{click:()=>A(e)}}]}))(t),!0),setTimeout(()=>(t.pushStatus(503),t.stopSubsequentRenders=!0),500)),D=async(e=!0)=>{router.stopSubsequentRenders=!1,h.empty(router.root),router.root.appendChild(new b(null,null,m({margin:"auto",position:"fixed",top:0,bottom:0,left:0,right:0}))),router.root.appendChild((()=>{const e=h.create("div",{style:"margin:auto;text-align:center"});return e.textContent="Connecting to the server",e})()),await T.get("/api/gen_204"),setTimeout(()=>e?router.startLoad():void 0,450)};async function A(e,t){return j(()=>D(t),2,t=>R(t,e))}const U=new class{_setVars(){this.chatID=this.THERE=null}async getIntegrity(){const e=(await(await T.post("/api/integrity/",!0,g({integrity:this.Integrity}))).json()).key;return this.Integrity=e,e}async getUser(e=!1,t=!1){if(this.HERE&&!e)return!t||this.HERE;try{const e=await T.get("/api/getuser");if(e.ok&&!e.error){const s=await e.text();return this.HERE=s.substr(3),!t||this.HERE}return!1}catch(e){return console.log(e),!1}}constructor(){this._setVars()}},j=async(e,t,s)=>{let n;for(let s=0;s<t;s++){try{return await e()}catch(e){n=e}await(()=>new Promise(e=>{setTimeout(()=>e(),100)}))()}s(n)},P=async(e,t={})=>{const s=`/?${g({continue:e||location.hash.substr(1)})}`,n=`${location.protocol}//${location.host}/#${s}`;return!await U.getUser(!0,!0)&&(n==t.oldURL?(console.log("Same url navigation"),{stopExec:!0}):(console.log("Not logged in"),r(s),{stopExec:!0}))};(()=>{const e=document.createElement("template"),t=m({margin:"5px",width:"fit-content","border-radius":"15px","max-width":"45%",display:"flex",padding:"6px","margin-top":"5px",color:"#fff",cursor:"pointer","text-align":"left","overflow-wrap":"break-word","word-break":"break-word"});e.innerHTML=`<style>:host{${t}}</style><slot></slot>`})();s(2),s(3),s(4);var H=s(0),O=s.n(H),B=s(1),N=s.n(B);class F extends HTMLElement{createTemplate(){const e=h.create("div",{class:"bxcs"}),t=h.create("div",{class:"__div",textContent:this.title}),s=h.create("div",{textContent:this.body,class:"body"}),n=h.create("button",{class:"action",textContent:this.action1}),r=h.create("div");e.appendChild(t),e.appendChild(s),e.appendChild(r),r.appendChild(n);const i=h.create("template");return i.innerHTML=e.outerHTML+"<style>.action{cursor:pointer}.__div{font-weight:bold}.action,.bxcs{background-color:#fff}input{width:90%;border-radius:20px;border:2px solid #e3e3e3;padding:4px;outline:0}.bxcs{position:fixed;width:85%;margin:auto;right:0;left:0;top:2px;border-radius:10px;height:auto;padding:10px;z-index:20;box-shadow:0 2px 8px 0 #04040426}.action{color:#4749e4;font-weight:700;border:none;outline:0}</style>",i}startTick(e=4e3){setTimeout(()=>this.remove(),e)}constructor(e,t,s,n,r,i=null,o){super(),this.title=e,this.body=t,this.bodyOnClick=s,this.action1=n,this.action1onClick=r||{},this.input=i;const a=this.createTemplate(),c=this.attachShadow({mode:"open"});if(c.appendChild(a.content.cloneNode(!0)),c.querySelector(".bxcs").onclick=s,this.action1onClick.showInput){let e;const t=c.querySelector(".action");this.input&&(e=h.create("input",{id:"input"})),e.onkeydown=(s=>{if(13===s.keyCode)return e.replaceWith(t),o(s),this.remove()}),t.onclick=(()=>{t.replaceWith(e),e.focus(),this.remove()})}else c.querySelector(".action").onclick=(e=>(r(e),this.remove()))}}v("mat-notify",F);const W=(()=>{const e=async()=>null;let t=e,s=e,n=e,r=e,i=e;if(indexedDB){class e{constructor(e="WebCache",t="KeyStore"){this.storeName=t,this._dbase=new Promise((s,n)=>{const r=indexedDB.open(e,1);r.onerror=(e=>(console.log(e),s(null))),r.onsuccess=(()=>{s(r.result)}),r.onupgradeneeded=(()=>{r.result.createObjectStore(t)})})}__IDBAct__(e,t){return this._dbase.then(s=>new Promise((n,r)=>{const i=s.transaction(this.storeName,e);i.oncomplete=(()=>n()),i.onabort=i.onerror=(()=>r()),t(i.objectStore(this.storeName))})).catch(e=>(console.log(e),null))}}let o;const a=()=>o||new e;t=((e,t=a())=>{let s;return t.__IDBAct__("readonly",t=>{s=t.get(e)}).then(()=>s.result).catch(e=>(console.log(e),null))}),s=((e,t,s=a())=>{try{return s.__IDBAct__("readwrite",s=>{s.put(t,e)})}catch(e){return null}}),i=((e,t=a())=>{try{t.__IDBAct__("readwrite",t=>{t.delete(e)})}catch(e){return null}}),r=((e=a())=>{try{return console.warn("clearing Store:",e),e.__IDBAct__("readwrite",e=>{e.clear()})}catch(e){return e}}),n=((e=a())=>{const t=[];return e.__IDBAct__("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t).catch(e=>null)})}return{get:t,set:s,__clear__:r,keys:n,del:i}})();class q extends HTMLElement{constructor({message:e,sender:t,receiver:s,stamp:n,read:r,rstamp:i,seen_read:o,edited:a},c,l,d){super(),this.message=e,"string"!=typeof e&&(this.media=this.message.media,this.mediaURL=this.message.mediaURL),this.sender=t,this.receiver=s,this.stamp=n,this.edited=a,this.read=r,this.rstamp=i,this.seen_read=o,this.$id=c;const h=document.createElement("template");this.user=d,h.innerHTML="<style>:host{display:flex;flex-direction:column}:host.received{textalign:left}:host.sent{text-align:right}[message]{text-align:justify;margin:5px;width:fit-content;border-radius:15px;max-width:45%;display:inline-flex;padding:6px;cursor:pointer;overflow-wrap:break-word;word-break:break-word}[message].sent{background:#d2e3fc;color:#174ea6;margin-left:auto}[message].received{margin-right:auto;background-color:#f1f3f4;color:#000000de}[time]{display:flex;font-weight:200;color: #0000005e;font-size:12px;margin:10px;-webkit-transition:.2s;transition:.2s;-webkit-transform:translate(0,0);transform:translate(0,0)}[time].sent{flex-direction:row-reverse;}[time].received{flex-direction:row}</style><div message></div><div time></div>";const u=this.attachShadow({mode:"open"});u.appendChild(h.content.cloneNode(!0)),this.msg=u.querySelector("div[message]"),this.time=u.querySelector("div[time]"),this.setAttribute("msg-id",this.$id),this.sender===l?(this.msg.classList.add("received"),this.time.classList.add("received"),this.classList.add("received")):this.sender===d&&(this.msg.classList.add("sent"),this.time.classList.add("sent"),this.classList.add("sent"));try{this.msg.appendChild(this._messageOrMedia())}catch(e){console.log(e,this)}this.time.textContent=this._GetInformativeTime(),this.onclick=(()=>{})}setRead(e,t){this.read=e,this.rstamp=t,this.shadowRoot.querySelector("div[time]").textContent=this._GetInformativeTime()}_messageOrMedia(){if(this.media){const e=document.createElement("img");return e.src=O.a,this.msg.onclick=(()=>{const e=document.createElement("a");e.href=this.mediaURL,e.target="__blank",e.click()}),e}if(this.message)return document.createTextNode(this.message)}_GetInformativeTime(){let e,t="",s="";return this.edited&&(s="[edited]"),this.sender!==this.user?e=this.stamp:this.read?(this.read&&(t="read "),e=this.rstamp):(t="sent ",e=this.stamp),s+t+_(e)}}v("text-message",q);const z={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},G=e=>{const t=h.create("div",{notification:!0,textContent:e});return t.onclick=(()=>t.remove()),t};class V{static async validateChatId(e){const t=await T.post("/api/chat-stats",!0,g({chat_id:e})),s=await t.json();if(s.error)return{error:s.error};const{HERE:n,chat_with:r,chat_id:i,is_online:o}=s;return{user:n,chat_id:i,peer:r,is_online:o}}_onIceCandidate({candidate:e}){if(e&&this._pc)return this._socket.send({type:"rtc_data",data:{icecandidate:e},peer:this._peer})}_iceStateChange(){this._pc.oniceconnectionstatechange=(async()=>{try{if(this.__unrendering__)return;const e=this._pc.iceConnectionState;if(["closed","disconnected","failed"].includes(e)){console.log("Connection is Dead.."),this._isOfferer=null,this._pc=null,this._dc=null,this.__USEWEBSOCKETFALLBACK__=!0,setTimeout(async()=>{await this._startConn()},2);const e=await J(this._chat_id);this.peer=e.peer,this._is_online=e.is_online,this.updateUI&&this.updateUI()}}catch(e){}})}_onDataChannel(){console.log(`[isOfferer=${this._isOfferer}]started data channel`,this._dc),this._dc.addEventListener("message",({data:e})=>i.emit("chat_message",e)),this.__USEWEBSOCKETFALLBACK__=!1}async _startRTCPings(){const e=this._isOfferer;if(this._pc=new RTCPeerConnection(z),this._pc.onicecandidate=(e=>this._onIceCandidate(e)),this._pc.oniceconnectionstatechange=(e=>this._iceStateChange(e)),e){this._dc=this._pc.createDataChannel(a());const e=await this._pc.createOffer();await this._pc.setLocalDescription(e),this._socket.send({type:"rtc_data",data:{rtc:"offer",js:e},peer:this._peer}),i.emit("on-dataChannel")}else this._pc.ondatachannel=(({channel:e})=>(this._dc=e,i.emit("on-dataChannel")))}async _parseRTCData(e){if(!e)return;console.log("Got rtc Data--\x3e",e);const{rtc:t,js:s,icecandidate:n}=e;return n&&this._pc?await this._pc.addIceCandidate(n):"offer"===t?(await this._pc.setRemoteDescription(s),await this._pc.setLocalDescription(await this._pc.createAnswer()),this._socket.send({type:"rtc_data",data:{rtc:"answer",js:this._pc.localDescription},peer:this._peer})):void("answer"===t&&await this._pc.setRemoteDescription(s))}_onWSmessage({data:e={}}){if("string"!=typeof e)return console.log("handle binary");const t=JSON.parse(e),{type:s,data:n,meta:o}=t;if(o.from!==this._peer&&o.from!==this._user){if("start_chat"!==s&&"online_status"!==s)return;console.log(`new chat offer from ${o.from}`);const e=new F("Start a Chat",`${o.from} is ready to chat!`,()=>r(`/chat/${n.common_chat_id}`),"Click to send a message",{showInput:1},!0,e=>{const t=e.target.value;t&&t.trim()&&this._socket.send({type:"message-relay",data:this._GenerateMessageTemplate?this._GenerateMessageTemplate(t):void 0})});return document.body.appendChild(e),e.startTick()}if(this._is_online||(this._is_online="online",this.updateUI()),"online_status"===s){const{isonline:e}=n;return this._is_online=e?"online":"offline",this.updateUI(),e?this._socket.send({type:"get_role",peer:this._peer}):void 0}if("get_role"===s)return this._socket.send({type:"send_role",data:{is_offerer:!!this._isOfferer},peer:this._peer});if("set_role"===s){if("boolean"==typeof this._isOfferer)return;return this._isOfferer=n.is_offerer,i.emit("use-rtc")}if("rtc_data"===s&&this._parseRTCData(n),"message-relay"===s&&i.emit("chat_message",n),"binary-file"===s){const e=G(`${this._peer} is sending a file`);document.body.appendChild(e),e.style.transform="translate(0px,0px)",setTimeout(()=>e.remove(),1500)}if("get-update"==s){const e=n.msgid;this.getElementByMessageId(e)&&this._socket.send({type:"update",peer:this._peer,data:{update_type:"read-update",details:{chat_id:this._chat_id,read:e,rstamp:f()}}})}"chat-update"===s&&this._updateMessages([n]),"ping-update"==s&&this._updateMessages(n)}get currentChatData(){return{chatID:this.chatID,user:this._user,peer:this._peer,is_online:this._is_online}}async _startConn(){if(this.updateUI(),i.EventCache["use-rtc"]&&i.detroyEvt("use-rtc"),i.listen("use-rtc",e=>e?this._startRTCPings():this._canUseRTC=!1),this._pc=null,this._isOfferer=null,this._dc=null,this._socket.isUsable&&this._socket.socket||(await this._socket.startConn("_/data/"),this.__updateTimeout__()),this._socket.send({type:"start_chat",peer:this._peer}),this._socket.onmessage=(e=>this._onWSmessage.call(this,e)),"offline"==this._is_online)return console.log("use websockets"),this._canUseRTC=!1}get supportsRTC(){return!!window.RTCPeerConnection&&!!window.RTCDataChannel}get UseRTC(){return this.supportsRTC&&(this.PeerObject||{}).isOnline&&this._canUseRTC}}class K extends V{updateUI(){try{const{peer:e,is_online:t}=this.currentChatData;this.peerbox=y(this._textarea,"peername"),this.peerstatus=y(this._textarea,"peerstatus"),this.peerbox.$$element.textContent=e,this.peerstatus.$$element.textContent=t}catch(e){}}_onUserMessage({detail:e}){let t;try{t=n(e)?e:JSON.parse(e)}catch(e){return console.warn(e)}const{type:s,sender:r,data:i}=t;if("message-relay"===s){this._lastMessageID+=1;const e={},t={...i,sender:r,receiver:i.peer};e[this._lastMessageID]=t,console.log("UPDATE-----\x3e",e),Y(this._chat_id,e);const s=new q(t,this._lastMessageID,this._peer,this._user);return this._textarea.$$element.appendChild(s),s.scrollIntoView(),this._lastMessageID}"typing"===s&&r===this._peer&&(clearTimeout(this.___typingTimeout),this.peerstatus.$$element.textContent="typing",this.___typingTimeout=setTimeout(()=>{this.peerstatus.$$element.textContent=this._is_online},700))}_GenerateMessageTemplate(e,t=f()){if(!e)throw new Error("Invalid Values");const s={type:"message-relay",peer:this._peer,sender:this._user,data:{chat_id:this._chat_id,msgid:this._lastMessageID,stamp:t,peer:this._peer}};return s.data.message=e,s}_sendTypingIndicator(){this._dc&&"open"===this._dc.readyState&&this._dc.send(JSON.stringify({type:"typing",sender:this._user}))}__sendMessage(e){return this.__USEWEBSOCKETFALLBACK__?this._socket.send(e):this._dc.send(JSON.stringify(e))}_sendMessageAndUpdateDataBase(e){const t=this._GenerateMessageTemplate(e);this._input.$$element.value="",this.__sendMessage(t);const s=this._onUserMessage({detail:{...t,sender:this._user,receiver:this._peer}});this._sendServerPing(e,s)}async _sendServerPing(e,t){const s={chat_id:this._chat_id,data:{sender:this._user,receiver:this._peer,message:e,stamp:f()}};console.log("sending to server---\x3e",s);const n=await T.post("/api/instant-message/",!0,JSON.stringify({details:s}),{"content-type":"application/json"}),r=(await n.json()).data;parseInt(r)!==parseInt(t)&&console.log("check for errors")}_setUpDataInputListeners(){this._input.events.keydown=(e=>(function(e,t,s){return 85===e.keyCode&&e.ctrlKey?(e.preventDefault(),this.$$element.value=this.$$element.value.slice(this.$$element.selectionStart,this.$$element.value.length),this.$$element.setSelectionRange(0,0)):13===e.keyCode?(this.attrs.value||"").trim()&&t(this.$$element.value):this.attrs.value=this.$$element.value,s()}).call(this._input,e,e=>this._sendMessageAndUpdateDataBase.call(this,e),()=>this._sendTypingIndicator.call(this))),this._input.events.keyup=(()=>(function(){const e=(this.$$element.value||"").trim(),t=y(this,"sendbtn"),s=y(this,"attachbtn");return e?s.$$element.parentElement&&(s.$$element.style.transform="translate(200px,0px)",setTimeout(()=>(t.add(),s.remove()),170)):(s.add(),t.remove(),setTimeout(()=>s.$$element.style.transform="translate(0px,0px)",20)),this.attrs.value=this.$$element.value}).call(this._input)),this._input.reRender(),this._submit_button.events=this._submit_button.events||{},this._submit_button.events.click=(()=>this._sendMessageAndUpdateDataBase.call(this,this._input.$$element.value)),this._submit_button.reRender()}async _updateMessages(e){for(const t of e){const{update_type:e,msg:s,rstamp:n,chat_id:r}=t;if("read"===e){const e=await W.get(r);if(e){const t=e.chats;t[s].read=!0,t[s].rstamp=n,e.chats=t,await W.set(r,e)}this.getElementByMessageId(s).setRead(!0,n)}}}_renderFetchedMessages(e){const t=Object.keys(e),s=document.createElement("div");for(const n of t){const t=e[n];if(this._lastMessageID=parseInt(n),!this._latestMessageElement){const e=new q(t,n,this._peer,this._user);s.appendChild(e),this._textarea.$$element.appendChild(s)}}}async _getUpdatesFromServer(){const e=(await W.get(this._chat_id)||{}).chats||{};console.log("idb data--\x3e",e),this._renderFetchedMessages(e),this._lastMessageID=Object.keys(e).length-1,this._latestMessageElement&&this._latestMessageElement.scrollIntoView();const t=await T.post("/api/updates/",!0,g({chat_id:this._chat_id,fetch_from:this._lastMessageID})),s=(await t.json()).message_data.messages;this._renderFetchedMessages(s),await Y(this._chat_id,s),this._latestMessageElement&&this._latestMessageElement.scrollIntoView()}async _sendBinaryFile(e){const t=G(`Sending File to ${this._peer}`);document.body.appendChild(t),t.style.transform="translate(0px,0px)",setTimeout(()=>t.remove(),1500);const s=new Response(e),n=await s.arrayBuffer();this._socket.send({type:"binary-file",data:{},peer:this._peer});const r=await T.post("/@/binary/",!0,n),i=(await r.json()).url;this._sendMessageAndUpdateDataBase({media:!0,mediaURL:i})}get _latestMessageElement(){if(this._lastMessageID)return this.getElementByMessageId(this._lastMessageID)}getElementByMessageId(e){return h.q(`text-message[msg-id="${e}"]`)}__updateTimeout__(){this.__socketInterval__=setInterval(async()=>{const e=await this._getUnreadMessages();e&&this._socket.send({type:"fetch-update",data:{msgids:e,chat_id:this._chat_id},peer:this._peer})},15e3)}async _getUnreadMessages(){const e=[],t=(await W.get(this._chat_id)||{}).chats;if(t){for(const s of Object.keys(t)){const n=t[s];n.read||n.sender!==this._user||e.push(s)}return e.length?e:null}return null}constructor(e,t,s=S()){super(),clearInterval(this.__socketInterval__),i.destroyAll(),i.listen("attach-img",({detail:e})=>this._sendBinaryFile.call(this,e)),i.listen("chat_message",e=>this._onUserMessage.call(this,e)),i.listen("on-dataChannel",e=>this._onDataChannel(e)),i.listen("unmount-router",()=>{i.destroyAll(),this._pc&&(this._socket.close(),clearInterval(this.__socketInterval__),this.__unrendering__=!0,this._pc.close(),this._pc=this._dc=this._peer=this._chat_id=this._isOfferer=null)}),this.__unrendering__=!1,this.__USEWEBSOCKETFALLBACK__=!0,this._isOfferer=null,this._canUseRTC=!0;const{user:n,chat_id:r,peer:o,is_online:a}=e;this._user=n,this._peer=o,this._is_online=a,this._chat_id=r,this._textarea=t,this._input=y(this._textarea,"chat_type"),this._submit_button=y(this._textarea,"sendbtn"),this._socket=s,this._getUpdatesFromServer(),this._startConn(),this._setUpDataInputListeners()}}async function J(e){return await K.validateChatId(e)}async function Y(e,t,s=!0){const n=await W.get(e)||{};if(s){const s={...n.chats,...t};return n.chats=s,await W.set(e,n)}return n.meta=t,await W.set(e,n)}const Q={element:"div",attrs:{class:"inpbox_"},children:[{element:"input",idx:"chat_type",attrs:{class:"textBox",spellcheck:"false",autocomplete:"none"},events:{}},{element:"img",idx:"attachbtn",events:{click(){const e=h.create("input",{type:"file"});e.oninput=(()=>i.emit("attach-img",e.files[0])),e.click()},contextmenu(e){e.preventDefault()}},attrs:{src:O.a,class:"attach-img"}},{idx:"sendbtn",element:"button",textContent:"send",attrs:{class:"send-btn"},onrender(){this.remove()}}]};var Z={route:"/chat/",element:"div",attrs:{},async beforeRender(e){const t=await P(this.currentRoute,this.getRouter().navData);return t?{stopExec:t}:(e||[])[0]?void 0:(this.getRouter().pushStatus(500,"No Chat ID Provided"),{stopExec:!0})},onUnmount:()=>(console.log("unmounting"),i.emit("unmount-router"),document.body.style.overflow="auto",document.body.style.background=document.documentElement.style.background="#e3e3e3"),async onrender(e){const t=y(this,"contentmain");let s,n;document.body.style.overflow="hidden",document.body.style.background=document.documentElement.style.background="#fff";const r=e[0],i=h.create("mat-spinner",{style:"position:absolute;top:0;bottom:0;right:0;left:0;margin-top:30%"});this.getRouter().root.appendChild(i);const o=(await W.get(r)||{}).meta;o&&(i.remove(),s=!0,n=new K(o,t));const a=await J(r);if(n){const e=n._is_online;n._is_online=a.is_online,"offline"!==e&&n._canUseRTC||"online"!==a.is_online||n._startConn(),n.updateUI()}const c=a;return c.is_online=void 0,i.remove(),Y(r,c,!1),!o||o.peer===a.peer&&o.chat_id===a.chat_id?a.error?this.getRouter().pushStatus(500,a.error):s?void 0:new K(a,t):(console.error("error!"),this.getRouter().pushStatus(500,"An Error occured while loading the chat data..please reload the page and try again"))},children:[{idx:"header",element:"div",attrs:{class:"header-div"},children:[{element:"div",attrs:{style:"display:grid"},children:[{element:"div",idx:"peername",attrs:{class:"peername"}},{element:"div",idx:"peerstatus",attrs:{class:"peerstatus"}}]},{element:"div",attrs:{class:"menuimg"},children:[{element:"img",attrs:{src:N.a},events:{click(){},contextmenu:e=>e.preventDefault()}}]}]},{element:"div",idx:"contentmain",attrs:{class:"ChatContent"}},{element:"div",idx:"inputbox",attrs:{class:"footer"},children:[Q]}]};v("mat-checkbox",class extends HTMLElement{set checked(e){const t=this.button;this._checked=!!e,e?t.classList.add("clicked"):t.classList.remove("clicked");const s=new Event("check");s.checked=this.checked,this.dispatchEvent(s)}set oncheck(e){this.eventListener=e,this.addEventListener("check",e)}get checked(){return this._checked}static get observedAttributes(){return["checked","boxstyle","buttonstyle"]}attributeChangedCallback(e,t,s){if("checked"===e){let t;return t="false"!==s&&"0"!==s,"checked"===e?this.checked=t:void 0}return"boxstyle"===e?this.boxtyle=s:"buttonstyle"===e?this.buttonstyle=s:void 0}_createTemplate(){const e=document.createElement("div"),t=document.createElement("button");e.appendChild(t);const s=document.createElement("template"),n=document.createElement("style");return n.innerHTML="div{-webkit-tap-highlight-color:transparent;background-color:#fff;cursor:pointer;border-radius:100px;height:20px;width:50px;display:inline-flex;border:2px solid #e3e3e3}button{box-shadow:0 1px 5px 0 #0009;display:block;margin-top:auto;margin-bottom:auto;height:inherit;border-radius:100%;border:none;width:20px;transition:all .2s ease-in-out 0s;cursor:pointer;outline:0}button.clicked{margin-left:30px;background-color:#033577}",s.innerHTML=n.outerHTML+e.outerHTML,s}set boxtyle(e){return this.box.style=e}set buttonstyle(e){return this.button.style=e}constructor(e,t){super();const s=this._createTemplate();this.attachShadow({mode:"open"}).appendChild(s.content.cloneNode(!0)),this.button=(()=>this.shadowRoot.querySelector("button"))(),this.box=(()=>this.shadowRoot.querySelector("div"))(),this.box.addEventListener("click",e=>(e.stopImmediatePropagation(),this.checked?this.checked=!1:this.checked=!0)),e&&(this.box.style=e),t&&(this.button.style=t)}});const X=(e,t)=>({element:"button",children:[{element:"a",textContent:e,attrs:{href:`#/chat/${t}`,class:"result_name"}}],events:{click:e=>(r(`/chat/${t}`),e.preventDefault())},attrs:{class:"searchresult"}});let ee;var te={element:"div",route:"/u/",attrs:{},async beforeRender(e){h.empty(this.getRouter().root);const t=P(this.currentRoute,this.getRouter().navData);if(t)return t;const s=e[0];return s&&s===user?void 0:(r(`/u/${user}`),{stopExec:!0})},onrender:()=>(console.log("TODO"),document.documentElement.style.backgroundColor=document.body.style.backgroundColor="#ffffff"),onUnmount:()=>document.documentElement.style.backgroundColor=document.body.style.backgroundColor="#e3e3e3",children:[{element:"div",attrs:{},children:[L("searchHint","Search for users","userSearch",{async keydown(e){if(85===e.keyCode&&e.ctrlKey)return e.preventDefault(),void(this.$$element.value="");if(13===e.keyCode){const e=y(this,"resultBox");e.attrs.textContent="",e.update(),e.children=[],e.reRender();const t=(this.attrs.value||"").trim();if(t){const s=y(this,"search-spinner");s.add();const n=await T.get(`/api/user-search/tokens/${await U.getIntegrity()}`),r=await n.text(),i=await T.post("/api/users/",!0,g({token:r,user:t})),o=(await i.json()).users||[];if(!o.length)return e.attrs.textContent="No Users Found",e.update(),s.remove();const a=[];for(const e of o)a.push(X(e.user,e.chat_id));e.children=a,s.remove(),e.reRender(e)}}}}),{idx:"search-spinner",element:"mat-spinner",attrs:{svgstyle:"margin:auto;margin-top:10px"},onrender(){this.remove()}},{element:"div",attrs:{},idx:"resultBox",children:[]}]},{idx:"prevChatsUI",element:"div",attrs:{style:{width:"80%",margin:"auto","border-top":"1px solid #000","margin-top":"10px"}},async onrender(){},children:[{attrs:{boxstyle:m({"margin-top":"20px"})},element:"mat-checkbox",events:{async check(e){j(()=>(function(e){const t=y(this,"prevChatsData"),s=y(this,"prevChatsMessage");this.attrs._checked=e.checked,e.checked?async function(){if(ee)t.children=ee,t.add();else{this.remove(),s.remove();const e=y(this,"loading-spinner");e.add();const n=await T.post("/api/chat_ids/",!0,g({user:await U.getUser(!1,!0)})),r=(await n.json()).previous_chats||[];if(!r.length)throw e.remove(),s.$$element.textContent="An error occured while searching for your chats",new Error("$bad length");const i=[];for(const e of r)i.push(X(e.user,e.chat_id));ee=i,t.children=i,t.safeRerender(t),e.remove(),this.add()}s.add(),s.attrs.textContent="Your Previous Chats",s.update()}.call(this):(s.attrs.textContent="Click to show your previous chats",s.update(),t.remove())}).call(this,e),1,e=>{console.log(e),y(this,"loading-spinner").remove();const t=y(this,"prevChatsMessage");return t.attrs.textContent="Could not find previus chats",t.update(),this.remove()})}}},{idx:"prevChatsMessage",element:"div",textContent:"Click to show your previous chats"},{idx:"loading-spinner",element:"mat-spinner",attrs:{svgstyle:"margin:auto"},onrender(){this.remove()}},{idx:"prevChatsData",element:"div",onrender(){this.remove()}}]}]};const se=e=>{const t=y(e,"__errorbox__");return t.textContent="Loading..",t.attrs.style.visibility="visible",t.reRender(t),t},ne={login:{fields_empty_or_session_error:"Check Your Username and Password or try to reload the page",no_such_user:"No Such User Exists",incorrect_password:"incorrect password"},register:{fields_empty_or_session_error:"Check Your Username and Password or try to reload the page",bad_request:"Bad Username or Password",username_taken:"Username Already Taken"}};function re(e,t){const s=(this.attrs.value||t.target.value).trim(),n=y(this,`${e}UserPH`);if(n.attrs.class.delete("error"),n.attrs.textContent="username",n.update(),s){if(!oe(s))return n.attrs.class.add("error"),n.attrs.textContent="Invalid Username",n.update(),this.attrs.hasError=!0;this.attrs.hasError=!1,13===t.keyCode&&y(this,`${e}PasswordInput`).$$element.focus()}}function ie(e){re.call(this,"login",e)}const oe=e=>{if(0<e.length)return/^[0-9a-zA-Z_.-]+$/.test(e)};function ae(e,t,s=(()=>{}),n="password"){const r=e.target.value,i=y(this,t);if(i.attrs.textContent=n,i.attrs.class.delete("error"),i.update(),13===e.keyCode)return!r.trim()||4>r.length?(i.attrs.class.add("error"),i.attrs.textContent="Invalid Password",i.update(),this.attrs.hasError=!0):(this.attrs.hasError=!1,s())}const ce=L("loginUserPH","username","loginUserInput",{keydown:ie,keyup(e){this.attrs.value=this.$$element.value,ie.call(this,e)}}),le=L("signupUserPH","username","signupUserInput",{keydown:function(e){re.call(this,"signup",e)},keyup(e){this.attrs.value=this.$$element.value,ie.call(this,e)}});var de={element:"div",attrs:{id:"auth-component",style:{margin:"auto","text-align":"center"}},async beforeRender(){if(await U.getUser(!0)){const{qs:e}=o(location),t=new URLSearchParams(e).get("continue");if(t)return r(t),{stopExec:!0};{const e=`/u/${U.HERE}`;return this.getRouter().isUserGoingBack(e)?{stopExec:!0}:(r(e),{stopExec:!0})}}},onrender:()=>console.log("Rendered Login Component"),children:[{idx:"loginBtn",element:"button",attrs:{style:{"border-radius":"5px",margin:"10px"},class:["ripple","actionbtn"]},textContent:"Login",events:{click(){const e=y(this,"sgupbx"),t=y(this,"loginBox");e.remove(),t.add()}}},{element:"button",attrs:{style:{"border-radius":"5px",margin:"10px"},class:["ripple","actionbtn"]},textContent:"signup",events:{click(){const e=y(this,"sgupbx"),t=y(this,"loginBox");e.add(),t.remove()}}},{element:"div",idx:"__errorbox__",attrs:{style:{visibility:"hidden",color:"#ff0000","font-weight":"bold"},textContent:""}},{element:"div",attrs:{id:"loginBox",style:{border:"2px solid #e3e3e3"}},onrender(){this.remove()},children:[ce,L("loginPasswordPH","password","loginPasswordInput",{keydown(e){return ae.call(this,e,"loginPasswordPH",()=>(function(e){const t=se(e),s=y(e,"loginUserInput");if(s.attrs.hasError||e.attrs.hasError)return;const n=s.$$element.value,i=e.$$element.value;return j(async()=>{const e=await T.post("/login/check/",!0,g({user:n,password:i,integrity:await U.getIntegrity()})),s=await e.json();if(!e.ok||s.error){const e=ne.login[s.error];return t.textContent=e||"An unknown error occured on our end..",t.reRender(t)}if(s.success){t.$$element.textContent="Authenticated";const{qs:e}=o(location),n=new URLSearchParams(e).get("continue");return r(n||`/u/${s.user}`),t.textContent="",t.reRender(t)}},2,e=>(console.log(e),t.textContent="An error occured..please try again",t.reRender(t)))})(this))},keyup(){this.attrs.value=this.$$element.value}},!0)],idx:"loginBox"},{element:"div",attrs:{id:"signupBox",style:{border:"2px solid #e3e3e3"}},onrender(){this.remove()},children:[le,L("signupPasswordPH","password","signupPasswordInput",{keydown(e){return ae.call(this,e,"signupPasswordPH",()=>y(this,"signupPassConfInput").$$element.focus())},keyup(){this.attrs.value=this.$$element.value}},!0),L("signupPassConfPH","confirm password","signupPassConfInput",{keydown(e){return ae.call(this,e,"signupPassConfPH",()=>(function(e){const t=se(e),s=y(e,"signupUserInput"),n=y(e,"signupPasswordInput");if(s.attrs.hasError||e.attrs.hasError||n.hasError)return;const r=s.$$element.value,i=n.$$element.value,o=e.$$element.value;j(async()=>{const e=await T.post("/register/check/",!0,g({user:r,password:i,checkpw:o,integrity:await U.getIntegrity()})),s=await e.json();if(!e.ok||s.error){const e=ne.register[s.error];return t.textContent=e||"An unknown error occured on our end..",t.reRender(t)}if(s.success)return t.textContent="Account Created. Please Login",t.reRender(t)},2,()=>t.$$element.textContent="An Unknown error occured..please try again")})(this),"confirm password")},keyup(){this.attrs.value=this.$$element.value}},!0)],idx:"sgupbx"}],route:"/"};(async e=>{let t;try{(t=document.createElement("link")).href=e,t.rel="stylesheet",document.head.appendChild(t)}catch(e){console.log("Could not append stylesheet",e)}})("https://fonts.googleapis.com/css?family=Open+Sans"),window.router=C;const he=C,ue=h.id("app-banner");ue&&(ue.style.display="block");const pe={route:"/logout/",element:"div",beforeRender:()=>he.isUserGoingBack("/")?{stopExec:!0}:T.post("/api/logout/",!0,"").then(()=>C.load("/")),textContent:"Logging you out"};he.registerRoute(pe),(async()=>{for(var e of[Z,te,de])he.registerRoute(e)})(),A(he,!1).then(()=>he.startLoad());navigator}]);