!function(e){function t(t){for(var r,i,o=t[0],c=t[1],u=t[2],d=0,h=[];d<o.length;d++)i=o[d],a[i]&&h.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);h.length;)h.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={0:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;s.push([27,1]),n()}({12:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTYuNSA2djExLjVjMCAyLjIxLTEuNzkgNC00IDRzLTQtMS43OS00LTRWNWMwLTEuMzggMS4xMi0yLjUgMi41LTIuNXMyLjUgMS4xMiAyLjUgMi41djEwLjVjMCAuNTUtLjQ1IDEtMSAxcy0xLS40NS0xLTFWNkgxMHY5LjVjMCAxLjM4IDEuMTIgMi41IDIuNSAyLjVzMi41LTEuMTIgMi41LTIuNVY1YzAtMi4yMS0xLjc5LTQtNC00UzcgMi43OSA3IDV2MTIuNWMwIDMuMDQgMi40NiA1LjUgNS41IDUuNXM1LjUtMi40NiA1LjUtNS41VjZoLTEuNXoiLz48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PC9zdmc+Cg=="},14:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZwogIHdpZHRoPSI0MCIKICBoZWlnaHQ9IjQwIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICB2aWV3Qm94PSIwIDAgMjQgMjQiCj4KICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIj48L3BhdGg+CiAgPHBhdGgKICAgIGQ9Ik0xMiA4YzEuMSAwIDItLjkgMi0ycy0uOS0yLTItMi0yIC45LTIgMiAuOSAyIDIgMnptMCAyYy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnptMCA2Yy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnoiCiAgPjwvcGF0aD4KPC9zdmc+Cg=="},24:function(e,t,n){},25:function(e,t,n){},26:function(e){e.exports={}},27:function(e,t,n){"use strict";n.r(t);var r,a=n(0),s=n.n(a),i=n(1),o=n.n(i),c=n(5),u=n.n(c),l=n(4),d=n.n(l),h=n(6),p=n.n(h),f=n(7),v=n.n(f),m=n(9),g=n.n(m),_=n(2),y=n.n(_),x=n(3),k=n.n(x),b=n(11),w=n.n(b),C=function(e){return e.constructor===Object},I=function(e){if("string"==typeof e)return"/"===e[0]?location.hash=e:location.hash="/".concat(e)},M=new(function(){function e(){y()(this,e),this.EventCache={}}return k()(e,[{key:"emit",value:function(e,t){return window.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"listen",value:function(e,t){return this.EventCache[e]=t,window.addEventListener(e,t)}},{key:"detroyEvt",value:function(e,t){window.removeEventListener(e,t)}},{key:"destroyAll",value:function(){for(var e=Object.keys(this.EventCache),t=0;t<e.length;t++){var n=e[t];this.detroyEvt(n,this.EventCache[n])}}}]),e}()),S=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location;if("#"===t[0])e=t.substr(1);else try{e=new URL(t).hash.substr(1)}catch(t){e="/",console.log(t)}var n=e.split("?"),r=[0===e.length?"/":n[0],n[1]];return{path:r[0],qs:r[1]}},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return g()(Array(e)).join(".").replace(/[.]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})},T=((r=document.createElement("style")).innerHTML="",document.head.appendChild(r),r.sheet),L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T;return Array.from(t.rules).filter(function(t){return t.selectorText===e})[0]},R=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T,r=Object.keys(t),a=0;a<r.length;a++){var s=r[a];if(!["$$element","$$parent"].includes(s)){var i=t[s];if("class"===s)e.className="string"==typeof i?i:g()(i).join(" ");else if("events"===s)for(var o=Object.keys(i),c=0;c<o.length;c++){var u=o[c],l=i[u];e.addEventListener(u,l)}else if("style"===s){var d=void 0,h=void 0,p=void 0;if(d=C(i)?A(i):i,p=e.getAttribute("_routercontent")||t._routercontent){var f=L('[_routercontent="'.concat(p,'"]'));f?f.style=d:h=!0}else p=E(),h=!0;h&&(e.setAttribute("_routercontent",p),n.insertRule("[_routercontent='".concat(p,"']{").concat(d,"}")))}else["___innerHTML___","innerText","textContent"].includes(s)?"___innerHTML___"===s?e.innerHTML=i:e.textContent=i:e.setAttribute(s,i)}}},$={q:function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?document.querySelector(e):Array.from(document.querySelectorAll(e))},id:function(e){return document.getElementById(e)},className:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Array.from(document.getElementsByClassName(e));return t?n[0]:n},create:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T,r=document.createElement(e);return t&&"object"==w()(t)&&R(r,t,n),r},get:function(e,t){return e.getAttribute(t)},set:function(e,t,n){return e.setAttribute(t,n)},empty:function(e){var t;for(t=e.lastChild;t;)e.removeChild(t),t=e.lastChild}},D=function(e){return e instanceof Function},U=function(e){return"AsyncFunction"===e.constructor.name},A=function(e){if("string"==typeof e)return e;for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var a=n[r];t.push("".concat(a,":").concat(e[a]))}return t.join(";")},P=function(e){return window.URLSearchParams?new URLSearchParams(e):"".concat(Object.keys(e).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))}).join("&"))};var j=function(){return(new Date).getTime()},O=function(e,t){if(e){var n=e.routeCache();return n?n[t]:null}return null};function H(e,t){if(!window.customElements.get(e))return window.customElements.define(e,t)}$.q("noscript").remove();var N={element:"a",attrs:{href:"/#/",style:{display:"block",color:"#000"}},events:{click:function(e){e.preventDefault(),location.hash="/"}},textContent:"Click Here to Go Back",children:[]},B={display:"block","text-align":"center","font-family":"sans-serif",padding:"8px",margin:"auto","font-weight":"bold"},F=new(function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.$ROOT||$.id("app-root")||$.q("body");y()(this,e),this._setVars(n),window.onhashchange=function(e){return t.navData=e,t.routeChange(),t._runDirectives()},this._runDirectives()}return k()(e,[{key:"parseHash",value:function(e){return S(e)}},{key:"__runConditionals",value:function(){var e=o()(s.a.mark(function e(){var t,n,r,a,i,o,c,u,l,d,h,p;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=g()(document.querySelectorAll("[_routerif]")),n=!0,r=!1,a=void 0,e.prev=4,i=t[Symbol.iterator]();case 6:if(n=(o=i.next()).done){e.next=26;break}if(c=o.value,u=$.get(c,"_routerif"),l=$.get(c,"_routerthen"),!new Function("$","return ".concat(u)).call(this,c)){e.next=16;break}(d=c.$)&&(c.replaceWith(d),l&&new Function("$",l).call(this,d)),e.next=23;break;case 16:if(!(c.$ instanceof HTMLElement)){e.next=18;break}return e.abrupt("continue",23);case 18:h={_routerif:u},l&&(h._routerthen=l),(p=$.create("router-data",h)).$=c,c.replaceWith(p);case 23:n=!0,e.next=6;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(4),r=!0,a=e.t0;case 32:e.prev=32,e.prev=33,n||null==i.return||i.return();case 35:if(e.prev=35,!r){e.next=38;break}throw a;case 38:return e.finish(35);case 39:return e.finish(32);case 40:case"end":return e.stop()}},e,this,[[4,28,32,40],[33,,35,39]])}));return function(){return e.apply(this,arguments)}}()},{key:"__runEventListeners",value:function(){var e=o()(s.a.mark(function e(){var t,n,r,a,i,o,c,u=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=$.q("[_routerEvt][_routerAct]",!1),n=!0,r=!1,a=void 0,e.prev=4,i=function(){var e=c.value,t=$.get(e,"_routerEvt"),n=$.get(e,"_routerAct");e[t]=function(){new Function(n).call(u)}},o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0)i();e.next=13;break;case 9:e.prev=9,e.t0=e.catch(4),r=!0,a=e.t0;case 13:e.prev=13,e.prev=14,n||null==o.return||o.return();case 16:if(e.prev=16,!r){e.next=19;break}throw a;case 19:return e.finish(16);case 20:return e.finish(13);case 21:case"end":return e.stop()}},e,this,[[4,9,13,21],[14,,16,20]])}));return function(){return e.apply(this,arguments)}}()},{key:"_runDirectives",value:function(){var e=o()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.__runConditionals();case 2:this.__runEventListeners();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_callFuncWithThis",value:function(e,t,n,r){if(U(e))return e.apply(t,[r]).then(function(e){return n&&(e||{}).stopUpdate&&R(n,t.attrs),e});var a=e.apply(t,[r]);return n&&((a||{}).stopUpdate||R(n,t.attrs)),a}},{key:"_setVars",value:function(e){var t=this;this.stopSubsequentRenders=!1,this.root=e,this.routeMap={},this.routes=[],this.routeCache={},this.unMountFn=function(){},this.unmountRoute=function(){t.unMountFn(),t.routeCache={}},this.statusHandler={404:{element:"div",attrs:{style:B},textContent:"The Page you are requesting was not found",children:[N]},500:{element:"div",attrs:{style:B},textContent:"An Error Occured while trying to process your request",children:[N]}}}}]),k()(e,[{key:"isUserGoingBack",value:function(e){var t=this.navData||{};return!("".concat(location.protocol,"//").concat(location.host,"/#").concat(e)!=t.oldURL||(console.log("Same url navigation"),0))}},{key:"routeParser",value:function(e){return this.parseHash(e).path}},{key:"load",value:function(e){return I(e)}},{key:"lazyload",value:function(e,t,n){var r=this;n?this.registerRoute(n):this.registerRoute({route:e,element:"div",textContent:"loading",attrs:{style:{margin:"100px"}}});var a=this.getRouteName(this.currentRoute)===e;return a&&this.startLoad(),t.then(function(e){if(r.registerRoute(e.default),a)return r.startLoad()})}},{key:"startLoad",value:function(){this.routeChange()}},{key:"pushStatus",value:function(e,t){var n=this.statusHandler[e];return n.textContent=t||n.textContent,n?this.render(n,this.root,!0):this.render(this.statusHandler[404])}},{key:"getRouteName",value:function(e){var t=e.split("/").filter(function(e){return e})[0];return t?"/".concat(t,"/"):"/"}},{key:"isValidRoute",value:function(e){if(this.routes.includes(e))return{res:!0,args:null,_fRoute:e};try{var t=e.split("/").filter(function(e){return e}),n="/".concat(t[0],"/");return this.routes.includes(n)?{res:!0,args:t.slice(1),_fRoute:n}:{res:!1}}catch(t){return console.log(t),{res:!1}}}},{key:"routeChange",value:function(){var e=this.routeParser(location.href),t=this.isValidRoute(e),n=t.res,r=t.args,a=t._fRoute;n?(console.log("rendering"),this.render(this.routeMap[a],this.root,!0,r)):this.render(this.statusHandler[404],this.root,!0,r)}},{key:"__toSets",value:function(e){"string"==typeof e.attrs.class?e.attrs.class=new Set([e.attrs.class]):Array.isArray(e.attrs.class)&&(e.attrs.class=new Set(e.attrs.class))}},{key:"__objDef",value:function(e,t,n,r,a){var i=this,c=function(){return e.$$element};e.attrs=e.attrs||{},this.__toSets(e),e.getRouter=function(){return i},e.update=function(){if(c()&&e.attrs)return R(c(),e.attrs)},e.remove=function(){if(c().parentNode)return c().replaceWith((t=$.create("router-data"),e._$routerData=t,t));var t},e.add=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";e._$routerData&&(e._$routerData.replaceWith(c()),e._$routerData=void 0),t&&(c().style.display=t)},e.routeCache=function(){return i.routeCache},e.reRender=o()(s.a.mark(function o(){var u,l=arguments;return s.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return u=l.length>0&&void 0!==l[0]?l[0]:e,e.attrs._routercontent=c().getAttribute("_routercontent"),s.t0=c(),s.next=5,i.render(u,t,n,r,a);case 5:return s.t1=s.sent,s.abrupt("return",s.t0.replaceWith.call(s.t0,s.t1));case 7:case"end":return s.stop()}},o,this)})),e.safeRerender=function(t){e.add(),e.reRender(t),e.add()}}},{key:"render",value:function(){var e=o()(s.a.mark(function e(t,n){var r,a,i,o,c,u,l,d,h,p,f,v,m,g,_,y,x,k,b,w,C,I,M,S,E,T,L=this,R=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.length>2&&void 0!==R[2]&&R[2],a=R.length>3?R[3]:void 0,i=R.length>4?R[4]:void 0,!this.stopSubsequentRenders){e.next=6;break}return console.log("preventing render"),e.abrupt("return");case 6:if(t){e.next=8;break}return e.abrupt("return");case 8:if(o=a||[],this._runDirectives(),c=t.element,u=t.attrs,l=t.beforeRender,d=t.onrender,h=t.textContent,p=t._innerHTML,f=t.onUnmount,v=t.events,m=t.children,g=t.isRoute,this.__objDef(t,n,r,o,i),(g||r)&&this.unmountRoute(),!D(l)){e.next=23;break}if(!U(l)){e.next=20;break}return e.next=17,this._callFuncWithThis(l,t,null,o);case 17:_=e.sent,e.next=21;break;case 20:_=this._callFuncWithThis(l,t,null,o);case 21:if(!_||!_.stopExec){e.next=23;break}return e.abrupt("return");case 23:for(y=$.create(c,u),x={},t.idx&&(x[t.idx]=t),Object.assign(this.routeCache,W(m),x),t.$$element=y,t.$$parent=i||null,h||0===h?y.textContent=h:p&&(console.warn("innerHTML can be dangerous!"),y.innerHTML=p),k=Object.keys(v||{}),b=function(){var e=k[w];y.addEventListener(e,function(n){return L._callFuncWithThis(v[e],t,y,n)})},w=0;w<k.length;w++)b();for(C=!0,I=!1,M=void 0,e.prev=36,S=(m||[])[Symbol.iterator]();!(C=(E=S.next()).done);C=!0)T=E.value,this.render(T,y,!1,null,t);e.next=44;break;case 40:e.prev=40,e.t0=e.catch(36),I=!0,M=e.t0;case 44:e.prev=44,e.prev=45,C||null==S.return||S.return();case 47:if(e.prev=47,!I){e.next=50;break}throw M;case 50:return e.finish(47);case 51:return e.finish(44);case 52:if(r&&$.empty(n),n.appendChild(y),g&&(this.unMountFn=f||function(){}),!D(d)){e.next=62;break}if(!U(d)){e.next=61;break}return e.next=59,this._callFuncWithThis(d,t,y,o);case 59:e.next=62;break;case 61:this._callFuncWithThis(d,t,y,o);case 62:return e.abrupt("return",y);case 63:case"end":return e.stop()}},e,this,[[36,40,44,52],[45,,47,51]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"registerRoute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(e.route&&e.element&&"/"===e.route[0]||t))throw new Error("invalid values");if(!t){this.routes.includes(e.route)||this.routes.push(e.route);var n=e.element,r=e.children,a=e.selector,s=e.attrs,i=e.beforeRender,o=e.events,c=e.hasRouteArgs,u=e.onUnmount,l=e.onrender,d=e.route,h=e.textContent,p=e._innerHTML,f=e.idx;return this.routeMap[d]={idx:f,element:n,selector:a,beforeRender:i,onrender:l,hasRouteArgs:c,attrs:s,textContent:h,_innerHTML:p,events:o,children:r,onUnmount:u,isRoute:!0}}var v=e.status;this.statusHandler[v]=e}},{key:"currentQS",get:function(){return this.parseHash(location.hash).qs}},{key:"currentRoute",get:function(){return this.routeParser(location.href)}}]),e}());function W(e){if(!e)return{};var t={},n=!0,r=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var o=s.value;o.idx&&(t[o.idx]=o)}}catch(e){r=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t}H("router-data",function(e){function t(){var e;return y()(this,t),(e=u()(this,d()(t).call(this))).attachShadow({mode:"open"}).appendChild(Object.assign(document.createElement("style"),{innerHTML:":host{display:none}"})),e}return p()(t,e),t}(v()(HTMLElement)));var q=function(){var e=o()(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",((n=document.createElement("link")).href=t,n.rel="stylesheet",document.head.appendChild(n)));case 4:e.prev=4,e.t0=e.catch(0),console.log("Could not append stylesheet",e.t0);case 7:case"end":return e.stop()}},e,this,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),z=n(10),K=n.n(z),G=function(e){function t(e,n,r,a){var s;y()(this,t);var i=(s=u()(this,d()(t).call(this))).createTemplate();return s.attachShadow({mode:"open"}).appendChild(i.content.cloneNode(!0)),s.svg=function(){return s.shadowRoot.querySelector("svg")},s.circle=function(){return s.shadowRoot.querySelector("circle")},e&&(s.size=e),n&&(s.color=n),r&&(s.svg().style=r),a&&(s.circle().style=a),s}return p()(t,e),k()(t,[{key:"attributeChangedCallback",value:function(e,t,n){"size"===e?this.size=n:"color"===e?this.color=n:"svgstyle"===e?this.svgstyle=n:"circlestyle"===e&&(this.circlestyle=n)}},{key:"createTemplate",value:function(){var e=$.create("svg",{viewbox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"}),t=$.create("circle",{fill:"none","stroke-width":6,"stroke-linecap":"round",cx:33,cy:33,r:30}),n=document.createElement("template");e.appendChild(t);var r=document.createElement("style");return r.innerHTML="svg{display:inline-block;width: 65px;height: 65px;animation:rotator 1.4s linear infinite}@keyframes rotator{0%{transform:rotate(0)}100%{transform:rotate(270deg)}}circle{stroke:#6f70ee;stroke-dasharray:120;stroke-dashoffset:0;transform-origin:center;animation:dash 1.4s ease-in-out infinite}@keyframes dash{0%{stroke-dashoffset:120}50%{stroke-dasharray:200;stroke-dashoffset:190;transform:rotate(135deg)}100%{stroke-dashoffset:120;transform:rotate(450deg)}}",n.innerHTML=r.outerHTML+e.outerHTML,n}},{key:"size",set:function(e){var t=this.svg();t.style.height=t.style.width=e},get:function(){return this.svg().style.height}},{key:"color",set:function(e){this.circle().style.stroke=e},get:function(){return this.circle().style.stroke}},{key:"svgstyle",set:function(e){return this.svg().style=e}},{key:"circlestyle",set:function(e){return this.circle().style=e}}],[{key:"observedAttributes",get:function(){return["size","color","svgstyle","circlestyle"]}}]),t}(v()(HTMLElement));H("mat-spinner",G);var V,J=window.location.host.includes("localhost")?"localhost:5000":"webmsg.herokuapp.com",Y="".concat(window.location.protocol,"//").concat(J),Q=function(){function e(){y()(this,e)}return k()(e,[{key:"__defaultOnMessage",value:function(e){if(!["ping","pong"].includes(e.data)){var t=JSON.parse(e.data);this._socketID=t.socket_id}}},{key:"startConn",value:function(e){var t=this;return new Promise(function(n,r){var a;t.socket=new WebSocket((a=e,"".concat("https:"===window.location.protocol?"wss://":"ws://").concat(J,"/").concat(a))),t.socket.onopen=function(){t.socket.send("__init__"),t.socket.onmessage=t.__defaultOnMessage,t._pingPongs(),n(t.socket)},t.socket.onerror=function(e){return r(e)}})}},{key:"close",value:function(){try{this.socket.close()}catch(e){console.warn(e)}}},{key:"send",value:function(e){return this.socket.send(JSON.stringify(e))}},{key:"sendString",value:function(e){return this.socket.send(e)}},{key:"_pingPongs",value:function(){var e=this;this.pingtimer=setTimeout(function(){e.socket.readyState===e.socket.OPEN?(e.socket.send("ping"),e._pingPongs()):clearTimeout(e.pingtimer)},2e4)}},{key:"onmessage",set:function(e){this.socket.onmessage=function(t){return"ping"===t.data||"pong"===t.data?void 0:e(t)}}},{key:"readyState",get:function(){return this.socket.readyState}},{key:"isUsable",get:function(){return!this.socket||[WebSocket.OPEN,WebSocket.CONNECTING].includes(this.socket.readyState)}}]),e}(),Z=function(){return(V||{}).isUsable?V:V=new Q},X=function(){function e(){y()(this,e)}return k()(e,null,[{key:"get",value:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>1&&void 0!==i[1])||i[1],r=i.length>2&&void 0!==i[2]?i[2]:{},a=n?Y+t:t,e.next=5,fetch(a,{headers:r,credentials:"include"});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i,o=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(o.length>1&&void 0!==o[1])||o[1],r=o.length>2?o[2]:void 0,a=o.length>3&&void 0!==o[3]?o[3]:{"content-type":"application/x-www-form-urlencoded"},i=n?Y+t:t,e.next=6,fetch(i,{method:"post",body:r,headers:a,credentials:"include"});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}();var ee=function(){var e=function(e,t,n,r){var a={};return t.blur||(a.blur=function(){!function(e,t){if(!e.attrs.value||!e.attrs.value.trim()){var n=O(e,t);n.attrs.class.delete("moveup"),n.attrs.class.add("movedown"),n.update(),setTimeout(function(){return n.attrs.class.delete("movedown"),n.update()},110)}}(this,r),this.update()}),t.focus||(a.focus=function(){var e;this.attrs.untouched=!1,(e=O(this,r)).attrs.class.add("moveup"),e.attrs.class.delete("movedown"),e.update()},t.keydown||(a.keydown=function(e){85===e.keyCode&&e.ctrlKey&&(e.preventDefault(),this.$$element.value=this.$$element.value.slice(this.$$element.selectionStart,this.$$element.value.length),this.$$element.setSelectionRange(0,0))}),t.keyup||(a.keyup=function(){return this.attrs.value=this.$$element.value})),{idx:e,element:"input",attrs:{type:n?"password":"text",spellcheck:!1,class:"paper-input"},onrender:function(){this.attrs.value?this.$$element.focus():(this.attrs.untouched=!0,this.attrs.clean=!0)},events:K()({},t,a)}};return function(t,n,r,a){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return{element:"div",children:[{idx:t,onrender:function(){var e=O(this,r);e&&e.$$element&&e.$$element.value.trim()&&(this.attrs.class=new Set(["_animate","moveup"]))},element:"div",textContent:n,attrs:{class:"_animate"}},e(r,a,s,t)]}}}(),te=function(e,t){return console.log(e),t.registerRoute(function(e){return{element:"div",status:503,textContent:"An error occured while contacting the server..please reload the page and try again",attrs:{style:{margin:"auto","text-align":"center"},class:"_errComponent"},children:[{element:"button",attrs:{style:{background:"#fff",color:"#000",border:"1px solid #6f70ee","border-radius":"20px",display:"block",margin:"auto","margin-top":"20px",padding:"8px",width:"20%",outline:"none",cursor:"pointer"},class:"ripple"},textContent:"Reload",events:{click:function(){return re(e)}}}]}}(t),!0),setTimeout(function(){return t.pushStatus(503),t.stopSubsequentRenders=!0},500)},ne=function(){var e=o()(s.a.mark(function e(){var t,n=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(n.length>0&&void 0!==n[0])||n[0],router.stopSubsequentRenders=!1,$.empty(router.root),router.root.appendChild(new G(null,null,A({margin:"auto",position:"fixed",top:0,bottom:0,left:0,right:0}))),router.root.appendChild((r=void 0,(r=$.create("div",{style:"margin:auto;text-align:center"})).textContent="Connecting to the server",r)),e.next=7,X.get("/api/gen_204");case 7:setTimeout(function(){return t?router.startLoad():void 0},450);case 8:case"end":return e.stop()}var r},e,this)}));return function(){return e.apply(this,arguments)}}();function re(e,t){return ae.apply(this,arguments)}function ae(){return(ae=o()(s.a.mark(function e(t,n){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ie(function(){return ne(n)},2,function(e){return te(e,t)}));case 1:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var se=new(function(){function e(){y()(this,e),this._setVars()}return k()(e,[{key:"_setVars",value:function(){this.chatID=this.THERE=null}},{key:"getIntegrity",value:function(){var e=o()(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post("/api/integrity/",!0,P({integrity:this.Integrity}));case 2:return e.next=4,e.sent.json();case 4:return t=e.sent,n=t.key,this.Integrity=n,e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=o()(s.a.mark(function e(){var t,n,r,a,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]&&i[1],!this.HERE||t){e.next=6;break}if(!n){e.next=5;break}return e.abrupt("return",this.HERE);case 5:return e.abrupt("return",!0);case 6:return e.prev=6,e.next=9,X.post("/api/getuser");case 9:if(!(r=e.sent).ok||r.error){e.next=20;break}return e.next=13,r.text();case 13:if(a=e.sent,this.HERE=a.substr(3),!n){e.next=17;break}return e.abrupt("return",this.HERE);case 17:return e.abrupt("return",!0);case 20:return e.abrupt("return",!1);case 21:e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(6),console.log(e.t0),e.abrupt("return",!1);case 27:case"end":return e.stop()}},e,this,[[6,23]])}));return function(){return e.apply(this,arguments)}}()}]),e}()),ie=function(){var e=o()(s.a.mark(function e(t,n,r){var a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<n)){e.next=16;break}return e.prev=2,e.next=5,t();case 5:return e.abrupt("return",e.sent);case 8:e.prev=8,e.t0=e.catch(2),a=e.t0;case 11:return e.next=13,new Promise(function(e){setTimeout(function(){return e()},100)});case 13:i++,e.next=1;break;case 16:r(a);case 17:case"end":return e.stop()}},e,this,[[2,8]])}));return function(t,n,r){return e.apply(this,arguments)}}(),oe=function(){var e=o()(s.a.mark(function e(t){var n,r,a,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r="/?".concat(P({continue:t||location.hash.substr(1)})),a="".concat(location.protocol,"//").concat(location.host,"/#").concat(r),e.next=5,se.getUser(!0,!0);case 5:if(e.sent){e.next=15;break}if(a!=n.oldURL){e.next=12;break}return console.log("Same url navigation"),e.abrupt("return",{stopExec:!0});case 12:return e.abrupt("return",(console.log("Not logged in"),I(r),{stopExec:!0}));case 13:e.next=16;break;case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();n(24),n(25),n(26);var ce=n(12),ue=n.n(ce),le=n(14),de=n.n(le),he=n(8),pe=n.n(he),fe=function(e){function t(e,n,r,a,s){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6?arguments[6]:void 0;y()(this,t),(i=u()(this,d()(t).call(this))).title=e,i.body=n,i.bodyOnClick=r,i.action1=a,i.action1onClick=s||{},i.input=o;var l=i.createTemplate(),h=i.attachShadow({mode:"open"});if(h.appendChild(l.content.cloneNode(!0)),h.querySelector(".body").onclick=function(){r()},i.action1onClick.showInput){var p,f=h.querySelector(".action");i.input&&(p=$.create("input",{id:"input"})),p.onkeydown=function(e){if(13===e.keyCode)return p.replaceWith(f),c(e),i.remove()},f.onclick=function(){f.replaceWith(p),p.focus(),clearTimeout(i.$$timer)}}else h.querySelector(".action").onclick=function(e){return s(e)};return i}return p()(t,e),k()(t,[{key:"createTemplate",value:function(){var e=$.create("div",{class:"bxcs"}),t=$.create("div",{class:"__div",textContent:this.title}),n=$.create("div",{textContent:this.body,class:"body"}),r=$.create("button",{class:"action",textContent:this.action1}),a=$.create("div");e.appendChild(t),e.appendChild(n),e.appendChild(a),a.appendChild(r);var s=$.create("template");return s.innerHTML=e.outerHTML+"<style>".concat(".action{cursor:pointer}.__div{font-weight:bold}.action,.bxcs{background-color:#fff}input{width:90%;border-radius:20px;border:2px solid #e3e3e3;padding:4px;outline:0}.bxcs{position:fixed;width:85%;margin:auto;right:0;left:0;top:2px;border-radius:10px;height:auto;padding:10px;z-index:20;box-shadow:0 2px 8px 0 #04040426}.action{color:#4749e4;font-weight:700;border:none;outline:0}","</style>"),s}},{key:"startTick",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4e3;this.$$timer=setTimeout(function(){return e.remove()},t)}}]),t}(v()(HTMLElement));H("mat-notify",fe);var ve=function(){var e=(c=o()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)}),t=e,n=e,r=e,a=e,i=e;var c;if(indexedDB){var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"WebCache",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"KeyStore";y()(this,e),this.storeName=n,this._dbase=new Promise(function(e,r){var a=indexedDB.open(t,1);a.onerror=function(t){return console.log(t),e(null)},a.onsuccess=function(){e(a.result)},a.onupgradeneeded=function(){a.result.createObjectStore(n)}})}return k()(e,[{key:"__IDBAct__",value:function(e,t){var n=this;return this._dbase.then(function(r){return new Promise(function(a,s){var i=r.transaction(n.storeName,e);i.oncomplete=function(){return a()},i.onabort=i.onerror=function(){return s()},t(i.objectStore(n.storeName))})}).catch(function(e){return console.log(e),null})}}]),e}(),l=function(){return new u};t=function(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:l()).__IDBAct__("readonly",function(n){t=n.get(e)}).then(function(){return t.result}).catch(function(e){return console.log(e),null})},n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();try{return n.__IDBAct__("readwrite",function(n){n.put(t,e)})}catch(e){return null}},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l();try{t.__IDBAct__("readwrite",function(t){t.delete(e)})}catch(e){return null}},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l();try{return console.warn("clearing Store:",e),e.__IDBAct__("readwrite",function(e){e.clear()})}catch(e){return e}},r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l(),t=[];return e.__IDBAct__("readonly",function(e){(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(function(){return t}).catch(function(e){return null})}}return{get:t,set:n,__clear__:a,keys:r,del:i}}(),me=function(e){function t(e,n,r,a){var s,i=e.message,o=e.sender,c=e.receiver,l=e.stamp,h=e.read,p=e.rstamp,f=e.seen_read,v=e.edited;y()(this,t),(s=u()(this,d()(t).call(this))).message=i,"string"!=typeof i&&(s.media=s.message.media,s.mediaURL=s.message.mediaURL),s.sender=o,s.receiver=c,s.stamp=l,s.edited=v,s.read=h,s.rstamp=p,s.seen_read=f,s.$id=n;var m=document.createElement("template");s.user=a,m.innerHTML="<style>:host{display:flex;flex-direction:column}:host.received{textalign:left}:host.sent{text-align:right}[message]{text-align:justify;margin:5px;margin-bottom:0px;width:fit-content;border-radius:15px;max-width:45%;display:inline-flex;padding:6px;cursor:pointer;overflow-wrap:break-word;word-break:break-word}[message].sent{background:#d2e3fc;color:#174ea6;margin-left:auto}[message].received{margin-right:auto;background-color:#f1f3f4;color:#000000de}[time]{display:flex;font-weight:200;color: #0000005e;font-size:12px;margin:10px;margin-top:2px;-webkit-transition:.2s;transition:.2s;-webkit-transform:translate(0,0);transform:translate(0,0)}[time].sent{flex-direction:row-reverse;}[time].received{flex-direction:row}</style><div message></div><div time></div>";var g=s.attachShadow({mode:"open"});g.appendChild(m.content.cloneNode(!0)),s.msg=g.querySelector("div[message]"),s.time=g.querySelector("div[time]"),s.setAttribute("msg-id",s.$id),s.sender===r?(s.msg.classList.add("received"),s.time.classList.add("received"),s.classList.add("received")):s.sender===a&&(s.msg.classList.add("sent"),s.time.classList.add("sent"),s.classList.add("sent"));try{s.msg.appendChild(s._messageOrMedia())}catch(e){console.log(e,pe()(pe()(s)))}return s.time.textContent=s._GetInformativeTime(),s.onclick=function(){},s}return p()(t,e),k()(t,[{key:"setRead",value:function(e,t){this.read=e,this.rstamp=t,this.shadowRoot.querySelector("div[time]").textContent=this._GetInformativeTime()}},{key:"_messageOrMedia",value:function(){var e=this;if(this.media){var t=document.createElement("img");return t.src=ue.a,this.msg.onclick=function(){var t=document.createElement("a");t.href=e.mediaURL,t.target="__blank",t.click()},t}if(this.message)return document.createTextNode(this.message)}},{key:"_GetInformativeTime",value:function(){var e,t="",n="";return this.edited&&(n="[edited]"),this.sender!==this.user?e=this.stamp:this.read?(this.read&&(t="read "),e=this.rstamp):(t="sent ",e=this.stamp),n+t+function(e){try{var t={hour:"numeric",hour12:!0,minute:"numeric"},n=new Date(e),r=new Date;if(n.getFullYear()!==r.getFullYear()&&(t.year="numeric"),function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}(n,r)||(t.month=t.day="numeric"),n.getMonth())return Intl.DateTimeFormat("auto",t).format(n)}catch(t){return console.log(t),new Date(e).toLocaleString()}}(e)}}]),t}(v()(HTMLElement));H("text-message",me);var ge=function(e){if(S(location.href).path==="/chat/".concat(e.chat_id))console.log("not showing notification for current chat");else{var t;t=e.message&&e.message.media?"media message":e.message;var n=new fe(e.sender,t,function(){return I("/chat/".concat(e.chat_id))},"reply",{showInput:!0},!0,function(){var t=o()(s.a.mark(function t(n){var r,a,i,o,c;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.target.value,(a=Z()).isUsable&&a.socket){t.next=5;break}return t.next=5,a.startConn("_/data/");case 5:return i=j(),t.next=8,se.getUser(!1,!0);case 8:o=t.sent,c={details:{chat_id:e.chat_id,data:{sender:o,receiver:e.sender,message:r,stamp:i}}},X.post("/api/instant-message/",!0,JSON.stringify(c),{"content-type":"application/json"}),a.send({type:"message-relay",peer:e.sender,sender:o,data:{peer:e.sender,sender:o,type:"message-relay",data:{stamp:i,message:r,chat_id:e.chat_id,peer:e.sender}}});case 12:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());document.body.appendChild(n),n.startTick(2e3)}},_e={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},ye=function(e){var t=$.create("div",{notification:!0,textContent:e});return t.onclick=function(){return t.remove()},t},xe=function(e){function t(e,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z();y()(this,t),r=u()(this,d()(t).call(this)),clearInterval(r.__socketInterval__),M.destroyAll(),M.listen("attach-img",function(e){var t=e.detail;return r._sendBinaryFile.call(pe()(pe()(r)),t)}),M.listen("chat_message",function(e){return r._onUserMessage.call(pe()(pe()(r)),e)}),M.listen("on-dataChannel",function(e){return r._onDataChannel(e)}),M.listen("unmount-router",function(){M.destroyAll(),r._pc&&(r._socket.close(),clearInterval(r.__socketInterval__),r.__unrendering__=!0,r._pc.close(),r._pc=r._dc=r._peer=r._chat_id=r._isOfferer=null)}),r.__unrendering__=!1,r.__USEWEBSOCKETFALLBACK__=!0,r._isOfferer=null,r._canUseRTC=!0;var s=e.user,i=e.chat_id,o=e.peer,c=e.is_online;return r._user=s,r._peer=o,r._is_online=c,r._chat_id=i,r._textarea=n,r._input=O(r._textarea,"chat_type"),r._submit_button=O(r._textarea,"sendbtn"),r._socket=a,r._getUpdatesFromServer(),r._startConn(),r._setUpDataInputListeners(),r}return p()(t,e),k()(t,[{key:"updateUI",value:function(){try{var e=this.currentChatData,t=e.peer,n=e.is_online;this.peerbox=O(this._textarea,"peername"),this.peerstatus=O(this._textarea,"peerstatus"),this.peerbox.$$element.textContent=t,this.peerstatus.$$element.textContent=n}catch(e){}}},{key:"_onUserMessage",value:function(e){var t,n=this,r=e.detail;try{t=C(r)?r:JSON.parse(r)}catch(e){return console.warn(e)}var a=t,s=a.type,i=a.sender,o=a.data;if(console.log(t),"message-relay"===s){this._lastMessageID+=1;var c={},u=K()({},o,{sender:i,receiver:o.peer});c[this._lastMessageID]=u,console.log("UPDATE-----\x3e",c),we(u.chat_id,c);var l=new me(u,this._lastMessageID,this._peer,this._user);return this._textarea.$$element.appendChild(l),l.scrollIntoView(),this._lastMessageID}"typing"===s&&i===this._peer&&(clearTimeout(this.___typingTimeout),this.peerstatus.$$element.textContent="typing",this.___typingTimeout=setTimeout(function(){n.peerstatus.$$element.textContent=n._is_online},700))}},{key:"_GenerateMessageTemplate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j();if(!e)throw new Error("Invalid Values");var n={type:"message-relay",peer:this._peer,sender:this._user,data:{chat_id:this._chat_id,msgid:this._lastMessageID,stamp:t,peer:this._peer}};return n.data.message=e,n}},{key:"_sendTypingIndicator",value:function(){this._dc&&"open"===this._dc.readyState&&this._dc.send(JSON.stringify({type:"typing",sender:this._user}))}},{key:"__sendMessage",value:function(e){return this.__USEWEBSOCKETFALLBACK__?this._socket.send(e):this._dc.send(JSON.stringify(e))}},{key:"_sendMessageAndUpdateDataBase",value:function(e){var t=this._GenerateMessageTemplate(e);this._input.$$element.value="",this.__sendMessage(t);var n=this._onUserMessage({detail:K()({},t,{sender:this._user,receiver:this._peer})});this._sendServerPing(e,n)}},{key:"_sendServerPing",value:function(){var e=o()(s.a.mark(function e(t,n){var r,a,i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={chat_id:this._chat_id,data:{sender:this._user,receiver:this._peer,message:t,stamp:j()}},console.log("sending to server---\x3e",r),e.next=4,X.post("/api/instant-message/",!0,JSON.stringify({details:r}),{"content-type":"application/json"});case 4:return a=e.sent,e.next=7,a.json();case 7:i=e.sent,o=i.data,parseInt(o)!==parseInt(n)&&console.log("check for errors");case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setUpDataInputListeners",value:function(){var e=this;this._input.events.keydown=function(t){return function(e,t,n){return 85===e.keyCode&&e.ctrlKey?(e.preventDefault(),this.$$element.value=this.$$element.value.slice(this.$$element.selectionStart,this.$$element.value.length),this.$$element.setSelectionRange(0,0)):13===e.keyCode?(this.attrs.value||"").trim()&&t(this.$$element.value):this.attrs.value=this.$$element.value,n()}.call(e._input,t,function(t){return e._sendMessageAndUpdateDataBase.call(e,t)},function(){return e._sendTypingIndicator.call(e)})},this._input.events.keyup=function(){return function(){var e=(this.$$element.value||"").trim(),t=O(this,"sendbtn"),n=O(this,"attachbtn");return e?n.$$element.parentElement&&(n.$$element.style.transform="translate(200px,0px)",setTimeout(function(){return t.add(),n.remove()},170)):(n.add(),t.remove(),setTimeout(function(){return n.$$element.style.transform="translate(0px,0px)"},20)),this.attrs.value=this.$$element.value}.call(e._input)},this._input.reRender(),this._submit_button.events=this._submit_button.events||{},this._submit_button.events.click=function(){return e._sendMessageAndUpdateDataBase.call(e,e._input.$$element.value)},this._submit_button.reRender()}},{key:"_updateMessages",value:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i,o,c,u,l,d,h,p,f;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,r=!1,a=void 0,e.prev=3,i=t[Symbol.iterator]();case 5:if(n=(o=i.next()).done){e.next=23;break}if(c=o.value,u=c.update_type,l=c.msg,d=c.rstamp,h=c.chat_id,"read"!==u){e.next=20;break}return e.next=11,ve.get(h);case 11:if(!(p=e.sent)){e.next=19;break}return(f=p.chats)[l].read=!0,f[l].rstamp=d,p.chats=f,e.next=19,ve.set(h,p);case 19:this.getElementByMessageId(l).setRead(!0,d);case 20:n=!0,e.next=5;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(3),r=!0,a=e.t0;case 29:e.prev=29,e.prev=30,n||null==i.return||i.return();case 32:if(e.prev=32,!r){e.next=35;break}throw a;case 35:return e.finish(32);case 36:return e.finish(29);case 37:case"end":return e.stop()}},e,this,[[3,25,29,37],[30,,32,36]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_renderFetchedMessages",value:function(e){for(var t=Object.keys(e),n=document.createElement("div"),r=0;r<t.length;r++){var a=t[r],s=e[a];if(this._lastMessageID=parseInt(a),!this._latestMessageElement){var i=new me(s,a,this._peer,this._user);n.appendChild(i),this._textarea.$$element.appendChild(n)}}}},{key:"_getUpdatesFromServer",value:function(){var e=o()(s.a.mark(function e(){var t,n,r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve.get(this._chat_id);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:return t=e.t0,n=t.chats||{},console.log("idb data--\x3e",n),this._renderFetchedMessages(n),this._lastMessageID=Object.keys(n).length-1,this._latestMessageElement&&this._latestMessageElement.scrollIntoView(),e.next=13,X.post("/api/updates/",!0,P({chat_id:this._chat_id,fetch_from:this._lastMessageID}));case 13:return r=e.sent,e.next=16,r.json();case 16:return a=e.sent,i=a.message_data.messages,this._renderFetchedMessages(i),e.next=21,we(this._chat_id,i);case 21:this._latestMessageElement&&this._latestMessageElement.scrollIntoView();case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_sendBinaryFile",value:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=ye("Sending File to ".concat(this._peer)),document.body.appendChild(n),n.style.transform="translate(0px,0px)",setTimeout(function(){return n.remove()},1500),r=new Response(t),e.next=7,r.arrayBuffer();case 7:return a=e.sent,this._socket.send({type:"binary-file",data:{},peer:this._peer}),e.next=11,X.post("/@/binary/",!0,a);case 11:return i=e.sent,e.next=14,i.json();case 14:o=e.sent,c=o.url,this._sendMessageAndUpdateDataBase({media:!0,mediaURL:c});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getElementByMessageId",value:function(e){return $.q('text-message[msg-id="'.concat(e,'"]'))}},{key:"__updateTimeout__",value:function(){var e=this;this.__socketInterval__=setInterval(o()(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._getUnreadMessages();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:e._socket.send({type:"fetch-update",data:{msgids:n,chat_id:e._chat_id},peer:e._peer});case 6:case"end":return t.stop()}},t,this)})),5e3)}},{key:"_getUnreadMessages",value:function(){var e=o()(s.a.mark(function e(){var t,n,r,a,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,ve.get(this._chat_id);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0={};case 6:if(n=e.t0,!(r=n.chats)){e.next=23;break}a=Object.keys(r),i=0;case 11:if(!(i<a.length)){e.next=22;break}if(o=a[i],!(c=r[o]).read&&c.sender===this._user){e.next=18;break}return e.abrupt("continue",19);case 18:t.push(o);case 19:i++,e.next=11;break;case 22:return e.abrupt("return",t.length?t:null);case 23:return e.abrupt("return",null);case 24:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_latestMessageElement",get:function(){if(this._lastMessageID)return this.getElementByMessageId(this._lastMessageID)}}]),t}(function(){function e(){y()(this,e)}return k()(e,[{key:"_onIceCandidate",value:function(e){var t=e.candidate;if(t&&this._pc)return this._socket.send({type:"rtc_data",data:{icecandidate:t},peer:this._peer})}},{key:"_iceStateChange",value:function(){var e=this;this._pc.oniceconnectionstatechange=o()(s.a.mark(function t(){var n,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.__unrendering__){t.next=3;break}return t.abrupt("return");case 3:if(n=e._pc.iceConnectionState,!["closed","disconnected","failed"].includes(n)){t.next=17;break}return console.log("Connection is Dead.."),e._isOfferer=null,e._pc=null,e._dc=null,e.__USEWEBSOCKETFALLBACK__=!0,setTimeout(o()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._startConn();case 2:case"end":return t.stop()}},t,this)})),2),t.next=13,ke(e._chat_id);case 13:r=t.sent,e.peer=r.peer,e._is_online=r.is_online,e.updateUI&&e.updateUI();case 17:t.next=21;break;case 19:t.prev=19,t.t0=t.catch(0);case 21:case"end":return t.stop()}},t,this,[[0,19]])}))}},{key:"_onDataChannel",value:function(){console.log("[isOfferer=".concat(this._isOfferer,"]started data channel"),this._dc),this._dc.addEventListener("message",function(e){var t=e.data;return M.emit("chat_message",t)}),this.__USEWEBSOCKETFALLBACK__=!1}},{key:"_startRTCPings",value:function(){var e=o()(s.a.mark(function e(){var t,n,r=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._isOfferer,this._pc=new RTCPeerConnection(_e),this._pc.onicecandidate=function(e){return r._onIceCandidate(e)},this._pc.oniceconnectionstatechange=function(e){return r._iceStateChange(e)},!t){e.next=15;break}return this._dc=this._pc.createDataChannel(E()),e.next=8,this._pc.createOffer();case 8:return n=e.sent,e.next=11,this._pc.setLocalDescription(n);case 11:this._socket.send({type:"rtc_data",data:{rtc:"offer",js:n},peer:this._peer}),M.emit("on-dataChannel"),e.next=16;break;case 15:this._pc.ondatachannel=function(e){var t=e.channel;return r._dc=t,M.emit("on-dataChannel")};case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_parseRTCData",value:function(){var e=o()(s.a.mark(function e(t){var n,r,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(console.log("Got rtc Data--\x3e",t),n=t.rtc,r=t.js,!(a=t.icecandidate)){e.next=11;break}if(!this._pc){e.next=11;break}return e.next=8,this._pc.addIceCandidate(a);case 8:return e.abrupt("return",e.sent);case 11:if("offer"!==n){e.next=21;break}return e.next=14,this._pc.setRemoteDescription(r);case 14:return e.t0=this._pc,e.next=17,this._pc.createAnswer();case 17:return e.t1=e.sent,e.next=20,e.t0.setLocalDescription.call(e.t0,e.t1);case 20:return e.abrupt("return",this._socket.send({type:"rtc_data",data:{rtc:"answer",js:this._pc.localDescription},peer:this._peer}));case 21:if("answer"!==n){e.next=24;break}return e.next=24,this._pc.setRemoteDescription(r);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_onWSmessage",value:function(e){var t=e.data,n=void 0===t?{}:t;if("string"!=typeof n)return console.log("handle binary");var r=JSON.parse(n),a=r.type,s=r.data,i=r.meta;if(i.from!==this._peer&&i.from!==this._user){if("start_chat"!==a&&"online_status"!==a)return"message-relay"===a?(s.sender=i.from,console.log(s),ge(s)):void 0;console.log("new chat offer from ".concat(i.from));var o=new fe("Start a Chat","".concat(i.from," is ready to chat!"),function(){return I("/chat/".concat(s.common_chat_id))},"Chat",console.log);return document.body.appendChild(o),o.startTick()}if(this._is_online||(this._is_online="--",this.updateUI()),"online_status"===a){var c=s.isonline;return this._is_online=c?"online":"offline",this.updateUI(),c?this._socket.send({type:"get_role",peer:this._peer}):void 0}if("get_role"===a)return this._socket.send({type:"send_role",data:{is_offerer:!!this._isOfferer},peer:this._peer});if("set_role"===a){if("boolean"==typeof this._isOfferer)return;return this._isOfferer=s.is_offerer,M.emit("use-rtc")}if("rtc_data"===a&&this._parseRTCData(s),"message-relay"===a&&M.emit("chat_message",s),"binary-file"===a){var u=ye("".concat(this._peer," is sending a file"));document.body.appendChild(u),u.style.transform="translate(0px,0px)",setTimeout(function(){return u.remove()},1500)}if("get-update"==a){var l=s.msgid;this.getElementByMessageId(l)&&this._socket.send({type:"update",peer:this._peer,data:{update_type:"read-update",details:{chat_id:this._chat_id,read:l,rstamp:j()}}})}"chat-update"===a&&this._updateMessages([s]),"ping-update"==a&&this._updateMessages(s)}},{key:"_startConn",value:function(){var e=o()(s.a.mark(function e(){var t=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateUI(),M.EventCache["use-rtc"]&&M.detroyEvt("use-rtc"),M.listen("use-rtc",function(e){return e?(t._getUpdatesFromServer(),t._startRTCPings()):t._canUseRTC=!1}),this._pc=null,this._isOfferer=null,this._dc=null,this._socket.isUsable&&this._socket.socket){e.next=10;break}return e.next=9,this._socket.startConn("_/data/");case 9:this.__updateTimeout__();case 10:if(this._socket.send({type:"start_chat",peer:this._peer}),this._socket.onmessage=function(e){return t._onWSmessage.call(t,e)},"offline"!=this._is_online){e.next=15;break}return console.log("use websockets"),e.abrupt("return",this._canUseRTC=!1);case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"currentChatData",get:function(){return{chatID:this.chatID,user:this._user,peer:this._peer,is_online:this._is_online}}},{key:"supportsRTC",get:function(){return!!window.RTCPeerConnection&&!!window.RTCDataChannel}},{key:"UseRTC",get:function(){return this.supportsRTC&&(this.PeerObject||{}).isOnline&&this._canUseRTC}}],[{key:"validateChatId",value:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.post("/api/chat-stats",!0,P({chat_id:t}));case 2:return n=e.sent,e.next=5,n.json();case 5:if(!(r=e.sent).error){e.next=8;break}return e.abrupt("return",{error:r.error});case 8:return a=r.HERE,i=r.chat_with,o=r.chat_id,c=r.is_online,e.abrupt("return",{user:a,chat_id:o,peer:i,is_online:c});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}());function ke(e){return be.apply(this,arguments)}function be(){return(be=o()(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe.validateChatId(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function we(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=o()(s.a.mark(function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(c.length>2&&void 0!==c[2])||c[2],e.next=3,ve.get(t);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0={};case 6:if(a=e.t0,!r){e.next=16;break}return i=a.chats,o=K()({},i,n),a.chats=o,e.next=13,ve.set(t,a);case 13:return e.abrupt("return",e.sent);case 16:return a.meta=n,e.next=19,ve.set(t,a);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var Ie={element:"div",attrs:{class:"inpbox_"},children:[{element:"input",idx:"chat_type",attrs:{class:"textBox",spellcheck:"false",autocomplete:"none"},events:{}},{element:"img",idx:"attachbtn",events:{click:function(){var e=$.create("input",{type:"file"});e.oninput=function(){return M.emit("attach-img",e.files[0])},e.click()},contextmenu:function(e){e.preventDefault()}},attrs:{src:ue.a,class:"attach-img"}},{idx:"sendbtn",element:"button",textContent:"send",attrs:{class:"send-btn"},onrender:function(){this.remove()}}]},Me={idx:"header",element:"div",attrs:{class:"header-div"},children:[{element:"div",attrs:{style:"display:grid"},children:[{element:"div",idx:"peername",attrs:{class:"peername"}},{element:"div",idx:"peerstatus",attrs:{class:"peerstatus"}}]},{element:"div",attrs:{class:"menuimg"},children:[{element:"img",attrs:{src:de.a},events:{click:function(){},contextmenu:function(e){return e.preventDefault()}}}]}]},Se={element:"div",idx:"inputbox",attrs:{class:"footer"},children:[Ie]},Ee={route:"/chat/",element:"div",attrs:{},beforeRender:function(){var e=o()(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(this.currentRoute,this.getRouter().navData);case 2:if(!(n=e.sent)){e.next=5;break}return e.abrupt("return",{stopExec:n});case 5:if((t||[])[0]){e.next=9;break}return this.getRouter().pushStatus(500,"No Chat ID Provided"),e.abrupt("return",{stopExec:!0});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),onUnmount:function(){return console.log("unmounting"),M.emit("unmount-router"),document.body.style.overflow="auto",document.body.style.background=document.documentElement.style.background="#e3e3e3"},onrender:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i,o,c,u,l,d,h;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(this,"contentmain"),document.body.style.overflow="hidden",document.body.style.background=document.documentElement.style.background="#fff",i=t[0],o=$.create("mat-spinner",{style:"position:absolute;top:0;bottom:0;right:0;left:0;margin-top:30%"}),this.getRouter().root.appendChild(o),e.next=8,ve.get(i);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0={};case 11:return c=e.t0,(u=c.meta)&&(o.remove(),r=!0,a=new xe(u,n)),e.next=16,ke(i);case 16:if(l=e.sent,a&&(d=a._is_online,a._is_online=l.is_online,"offline"!==d&&a._canUseRTC||"online"!==l.is_online||a._startConn(),a.updateUI()),(h=l).is_online=void 0,o.remove(),we(i,h,!1),!u){e.next=26;break}if(u.peer===l.peer&&u.chat_id===l.chat_id){e.next=26;break}return console.error("error!"),e.abrupt("return",this.getRouter().pushStatus(500,"An Error occured while loading the chat data..please reload the page and try again"));case 26:if(!l.error){e.next=30;break}return e.abrupt("return",this.getRouter().pushStatus(500,l.error));case 30:if(!r){e.next=32;break}return e.abrupt("return");case 32:return e.abrupt("return",new xe(l,n));case 33:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),children:[Me,{element:"div",idx:"contentmain",attrs:{class:"ChatContent"}},Se]};if(window.Notification){if("undefined"==typeof firebase)throw new Error("hosting/init-error: Firebase SDK not detected. You must include it before /__/firebase/init.js");firebase.initializeApp({apiKey:"AIzaSyCrdjBktQNWizVmfjK50I7BGsIQcNFmKcI",databaseURL:"https://webmsg-py.firebaseio.com",storageBucket:"webmsg-py.appspot.com",authDomain:"webmsg-py.firebaseapp.com",messagingSenderId:"193257233140",projectId:"webmsg-py"})}function Te(){return Le.apply(this,arguments)}function Le(){return(Le=o()(s.a.mark(function e(){var t,n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof window.Notification){e.next=24;break}return t=firebase.messaging(),e.prev=2,console.log("Supports Notifications"),t.usePublicVapidKey("BGhv7XYjPBkpVoOEPbq2E19Is1ti_MYfboTDazKE0jgxPENxDqe0-U2p1OKEEgG4JH4Ycl8Wbxdv-UrrP_LcLmw"),e.next=7,t.requestPermission();case 7:return e.next=9,t.getToken();case 9:return n=function(){var e=o()(s.a.mark(function e(){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getToken();case 2:return n=e.sent,console.log("Token refreshed:"),console.log(n),e.next=7,X.post("/api/set-notification-token/",!0,P({token:n}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),e.next=12,n();case 12:t.onTokenRefresh(n),e.next=23;break;case 15:e.prev=15,e.t0=e.catch(2),console.warn(e.t0),r=$.create("div",{notification:!0,textContent:"Permission Denied"}),document.body.appendChild(r),r.style.transform="translate(0px,0px)",setTimeout(function(){return r.remove()},1500),console.log("Permission-Denied");case 23:"granted"===Notification.permission&&(console.log("Granted Notification Perm"),t.onMessage(function(){var e=o()(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=JSON.parse(t.data.data),ge(n);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 24:case"end":return e.stop()}},e,this,[[2,15]])}))).apply(this,arguments)}H("mat-checkbox",function(e){function t(e,n){var r;y()(this,t);var a=(r=u()(this,d()(t).call(this)))._createTemplate();return r.attachShadow({mode:"open"}).appendChild(a.content.cloneNode(!0)),r.button=r.shadowRoot.querySelector("button"),r.box=r.shadowRoot.querySelector("div"),r.box.addEventListener("click",function(e){return e.stopImmediatePropagation(),r.checked?r.checked=!1:r.checked=!0}),e&&(r.box.style=e),n&&(r.button.style=n),r}return p()(t,e),k()(t,[{key:"attributeChangedCallback",value:function(e,t,n){var r;return"checked"===e?(r="false"!==n&&"0"!==n,"checked"===e?this.checked=r:void 0):"boxstyle"===e?this.boxtyle=n:"buttonstyle"===e?this.buttonstyle=n:void 0}},{key:"_createTemplate",value:function(){var e=document.createElement("div"),t=document.createElement("button");e.appendChild(t);var n=document.createElement("template"),r=document.createElement("style");return r.innerHTML="div{-webkit-tap-highlight-color:transparent;background-color:#fff;cursor:pointer;border-radius:100px;height:20px;width:50px;display:inline-flex;border:2px solid #e3e3e3}button{box-shadow:0 1px 5px 0 #0009;display:block;margin-top:auto;margin-bottom:auto;height:inherit;border-radius:100%;border:none;width:20px;transition:all .2s ease-in-out 0s;cursor:pointer;outline:0}button.clicked{margin-left:30px;background-color:#033577}",n.innerHTML=r.outerHTML+e.outerHTML,n}},{key:"checked",set:function(e){var t=this.button;this._checked=!!e,e?t.classList.add("clicked"):t.classList.remove("clicked");var n=new Event("check");n.checked=this.checked,this.dispatchEvent(n)},get:function(){return this._checked}},{key:"oncheck",set:function(e){this.eventListener=e,this.addEventListener("check",e)}},{key:"boxtyle",set:function(e){return this.box.style=e}},{key:"buttonstyle",set:function(e){return this.button.style=e}}],[{key:"observedAttributes",get:function(){return["checked","boxstyle","buttonstyle"]}}]),t}(v()(HTMLElement)));var Re,$e=function(e,t){return{element:"button",children:[{element:"a",textContent:e,attrs:{href:"#/chat/".concat(t),class:"result_name"}}],events:{click:function(e){return I("/chat/".concat(t)),e.preventDefault()}},attrs:{class:"searchresult"}}};function De(e){var t=O(this,"prevChatsData"),n=O(this,"prevChatsMessage");function r(){return(r=o()(s.a.mark(function e(){var r,a,i,o,c,u,l,d,h,p,f;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Re){e.next=5;break}t.children=Re,t.add(),e.next=52;break;case 5:return this.remove(),n.remove(),(r=O(this,"loading-spinner")).add(),e.t0=X,e.t1=P,e.next=13,se.getUser(!1,!0);case 13:return e.t2=e.sent,e.t3={user:e.t2},e.t4=(0,e.t1)(e.t3),e.next=18,e.t0.post.call(e.t0,"/api/chat_ids/",!0,e.t4);case 18:return a=e.sent,e.next=21,a.json();case 21:if(i=e.sent,(o=i.previous_chats||[]).length){e.next=27;break}throw r.remove(),n.$$element.textContent="An error occured while searching for your chats",new Error("$bad length");case 27:for(c=[],u=!0,l=!1,d=void 0,e.prev=31,h=o[Symbol.iterator]();!(u=(p=h.next()).done);u=!0)f=p.value,c.push($e(f.user,f.chat_id));e.next=39;break;case 35:e.prev=35,e.t5=e.catch(31),l=!0,d=e.t5;case 39:e.prev=39,e.prev=40,u||null==h.return||h.return();case 42:if(e.prev=42,!l){e.next=45;break}throw d;case 45:return e.finish(42);case 46:return e.finish(39);case 47:Re=c,t.children=c,t.safeRerender(t),r.remove(),this.add();case 52:n.add(),n.attrs.textContent="Your Previous Chats",n.update();case 55:case"end":return e.stop()}},e,this,[[31,35,39,47],[40,,42,46]])}))).apply(this,arguments)}this.attrs._checked=e.checked,e.checked?function(){return r.apply(this,arguments)}.call(this):(n.attrs.textContent="Click to show your previous chats",n.update(),t.remove())}var Ue={element:"div",attrs:{},children:[ee("searchHint","Search for users","userSearch",{keydown:function(){var e=o()(s.a.mark(function e(t){var n,r,a,i,o,c,u,l,d,h,p,f,v,m,g;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(85!==t.keyCode||!t.ctrlKey){e.next=4;break}return t.preventDefault(),this.$$element.value="",e.abrupt("return");case 4:if(13!==t.keyCode){e.next=60;break}if((n=O(this,"resultBox")).attrs.textContent="",n.update(),n.children=[],n.reRender(),!(r=(this.attrs.value||"").trim())){e.next=60;break}return(a=O(this,"search-spinner")).add(),e.t0=X,e.t1="/api/user-search/tokens/",e.next=18,se.getIntegrity();case 18:return e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),e.next=22,e.t0.get.call(e.t0,e.t3);case 22:return i=e.sent,e.next=25,i.text();case 25:return o=e.sent,e.next=28,X.post("/api/users/",!0,P({token:o,user:r}));case 28:return c=e.sent,e.next=31,c.json();case 31:if(u=e.sent,(l=u.users||[]).length){e.next=37;break}return n.attrs.textContent="No Users Found",n.update(),e.abrupt("return",a.remove());case 37:for(d=[],h=!0,p=!1,f=void 0,e.prev=41,v=l[Symbol.iterator]();!(h=(m=v.next()).done);h=!0)g=m.value,d.push($e(g.user,g.chat_id));e.next=49;break;case 45:e.prev=45,e.t4=e.catch(41),p=!0,f=e.t4;case 49:e.prev=49,e.prev=50,h||null==v.return||v.return();case 52:if(e.prev=52,!p){e.next=55;break}throw f;case 55:return e.finish(52);case 56:return e.finish(49);case 57:n.children=d,a.remove(),n.reRender(n);case 60:case"end":return e.stop()}},e,this,[[41,45,49,57],[50,,52,56]])}));return function(t){return e.apply(this,arguments)}}()}),{idx:"search-spinner",element:"mat-spinner",attrs:{svgstyle:"margin:auto;margin-top:10px"},onrender:function(){this.remove()}},{element:"div",attrs:{},idx:"resultBox",children:[]}]},Ae={idx:"prevChatsUI",element:"div",attrs:{style:{width:"80%",margin:"auto","border-top":"1px solid #000","margin-top":"10px"}},onrender:function(){var e=o()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),children:[{attrs:{boxstyle:A({"margin-top":"20px"})},element:"mat-checkbox",events:{check:function(){var e=o()(s.a.mark(function e(t){var n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:ie(function(){return De.call(n,t)},1,function(e){console.log(e),O(n,"loading-spinner").remove();var t=O(n,"prevChatsMessage");return t.attrs.textContent="Could not find previus chats",t.update(),n.remove()});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},{idx:"prevChatsMessage",element:"div",textContent:"Click to show your previous chats"},{idx:"loading-spinner",element:"mat-spinner",attrs:{svgstyle:"margin:auto"},onrender:function(){this.remove()}},{idx:"prevChatsData",element:"div",onrender:function(){this.remove()}}]},Pe={element:"div",route:"/u/",attrs:{},beforeRender:function(){var e=o()(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if($.empty(this.getRouter().root),!(n=oe(this.currentRoute,this.getRouter().navData))){e.next=4;break}return e.abrupt("return",n);case 4:if((r=t[0])&&r===user){e.next=7;break}return e.abrupt("return",(I("/u/".concat(user)),{stopExec:!0}));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),onrender:function(){return function(){if("function"==typeof Notification){if("granted"!==Notification.permission){var e=$.create("div",{notification:!0,textContent:"Click to enable notification service. Long press or right click to remove this dialog",_routerif:"this.routeParser(location).includes('/u/')",events:{contextmenu:function(e){e.target.remove()}}});return document.body.appendChild(e),e.style.transform="translate(0px,0px)",e.onclick=function(){e.remove(),Te()}}Te()}}(),document.documentElement.style.backgroundColor=document.body.style.backgroundColor="#ffffff"},onUnmount:function(){return document.documentElement.style.backgroundColor=document.body.style.backgroundColor="#e3e3e3"},children:[Ue,Ae]},je=function(e){var t=O(e,"__errorbox__");return t.textContent="Loading..",t.attrs.style.visibility="visible",t.reRender(t),t},Oe={login:{fields_empty_or_session_error:"Check Your Username and Password or try to reload the page",no_such_user:"No Such User Exists",incorrect_password:"incorrect password"},register:{fields_empty_or_session_error:"Check Your Username and Password or try to reload the page",bad_request:"Bad Username or Password",username_taken:"Username Already Taken"}};function He(e,t){var n=(this.attrs.value||t.target.value).trim(),r=O(this,"".concat(e,"UserPH"));if(r.attrs.class.delete("error"),r.attrs.textContent="username",r.update(),n){if(!Be(n))return r.attrs.class.add("error"),r.attrs.textContent="Invalid Username",r.update(),this.attrs.hasError=!0;this.attrs.hasError=!1,13===t.keyCode&&O(this,"".concat(e,"PasswordInput")).$$element.focus()}}function Ne(e){He.call(this,"login",e)}var Be=function(e){if(0<e.length)return/^[0-9a-zA-Z_.-]+$/.test(e)};function Fe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"password",a=e.target.value,s=O(this,t);if(s.attrs.textContent=r,s.attrs.class.delete("error"),s.update(),13===e.keyCode)return!a.trim()||4>a.length?(s.attrs.class.add("error"),s.attrs.textContent="Invalid Password",s.update(),this.attrs.hasError=!0):(this.attrs.hasError=!1,n())}var We=ee("loginUserPH","username","loginUserInput",{keydown:Ne,keyup:function(e){this.attrs.value=this.$$element.value,Ne.call(this,e)}}),qe=ee("signupUserPH","username","signupUserInput",{keydown:function(e){He.call(this,"signup",e)},keyup:function(e){this.attrs.value=this.$$element.value,Ne.call(this,e)}}),ze={idx:"loginBtn",element:"button",attrs:{style:{"border-radius":"5px",margin:"10px"},class:["ripple","actionbtn"]},textContent:"Login",events:{click:function(){var e=O(this,"sgupbx"),t=O(this,"loginBox");e.remove(),t.add()}}},Ke={element:"button",attrs:{style:{"border-radius":"5px",margin:"10px"},class:["ripple","actionbtn"]},textContent:"signup",events:{click:function(){var e=O(this,"sgupbx"),t=O(this,"loginBox");e.add(),t.remove()}}},Ge={element:"div",attrs:{id:"loginBox",style:{border:"2px solid #e3e3e3"}},onrender:function(){this.remove()},children:[We,ee("loginPasswordPH","password","loginPasswordInput",{keydown:function(e){var t=this;return Fe.call(this,e,"loginPasswordPH",function(){return function(e){var t=je(e),n=O(e,"loginUserInput");if(!n.attrs.hasError&&!e.attrs.hasError){var r=n.$$element.value,a=e.$$element.value;return ie(o()(s.a.mark(function e(){var n,i,o,c,u,l,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=X,e.t1=P,e.t2=r,e.t3=a,e.next=6,se.getIntegrity();case 6:return e.t4=e.sent,e.t5={user:e.t2,password:e.t3,integrity:e.t4},e.t6=(0,e.t1)(e.t5),e.next=11,e.t0.post.call(e.t0,"/login/check/",!0,e.t6);case 11:return n=e.sent,e.next=14,n.json();case 14:if(i=e.sent,n.ok&&!i.error){e.next=19;break}return o=Oe.login[i.error],t.textContent=o||"An unknown error occured on our end..",e.abrupt("return",t.reRender(t));case 19:if(!i.success){e.next=27;break}return t.$$element.textContent="Authenticated",c=S(location),u=c.qs,l=new URLSearchParams(u),d=l.get("continue"),I(d||"/u/".concat(i.user)),t.textContent="",e.abrupt("return",t.reRender(t));case 27:case"end":return e.stop()}},e,this)})),2,function(e){return console.log(e),t.textContent="An error occured..please try again",t.reRender(t)})}}(t)})},keyup:function(){this.attrs.value=this.$$element.value}},!0)],idx:"loginBox"},Ve={element:"div",attrs:{id:"signupBox",style:{border:"2px solid #e3e3e3"}},onrender:function(){this.remove()},children:[qe,ee("signupPasswordPH","password","signupPasswordInput",{keydown:function(e){var t=this;return Fe.call(this,e,"signupPasswordPH",function(){return O(t,"signupPassConfInput").$$element.focus()})},keyup:function(){this.attrs.value=this.$$element.value}},!0),ee("signupPassConfPH","confirm password","signupPassConfInput",{keydown:function(e){var t=this;return Fe.call(this,e,"signupPassConfPH",function(){return function(e){var t=je(e),n=O(e,"signupUserInput"),r=O(e,"signupPasswordInput");if(!(n.attrs.hasError||e.attrs.hasError||r.hasError)){var a=n.$$element.value,i=r.$$element.value,c=e.$$element.value;ie(o()(s.a.mark(function e(){var n,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=X,e.t1=P,e.t2=a,e.t3=i,e.t4=c,e.next=7,se.getIntegrity();case 7:return e.t5=e.sent,e.t6={user:e.t2,password:e.t3,checkpw:e.t4,integrity:e.t5},e.t7=(0,e.t1)(e.t6),e.next=12,e.t0.post.call(e.t0,"/register/check/",!0,e.t7);case 12:return n=e.sent,e.next=15,n.json();case 15:if(r=e.sent,n.ok&&!r.error){e.next=20;break}return o=Oe.register[r.error],t.textContent=o||"An unknown error occured on our end..",e.abrupt("return",t.reRender(t));case 20:if(!r.success){e.next=23;break}return t.textContent="Account Created. Please Login",e.abrupt("return",t.reRender(t));case 23:case"end":return e.stop()}},e,this)})),2,function(){return t.$$element.textContent="An Unknown error occured..please try again"})}}(t)},"confirm password")},keyup:function(){this.attrs.value=this.$$element.value}},!0)],idx:"sgupbx"},Je={element:"div",attrs:{id:"auth-component",style:{margin:"auto","text-align":"center"}},beforeRender:function(){var e=o()(s.a.mark(function e(){var t,n,r,a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.getUser(!0);case 2:if(!e.sent){e.next=16;break}if(t=S(location),n=t.qs,r=new URLSearchParams(n),!(a=r.get("continue"))){e.next=11;break}return I(a),e.abrupt("return",{stopExec:!0});case 11:if(i="/u/".concat(se.HERE),!this.getRouter().isUserGoingBack(i)){e.next=14;break}return e.abrupt("return",{stopExec:!0});case 14:return I(i),e.abrupt("return",{stopExec:!0});case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),onrender:function(){return console.log("Rendered Login Component")},children:[ze,Ke,{element:"div",idx:"__errorbox__",attrs:{style:{visibility:"hidden",color:"#ff0000","font-weight":"bold"},textContent:""}},Ge,Ve],route:"/"},Ye=n(15),Qe=n.n(Ye);q("https://fonts.googleapis.com/css?family=Open+Sans"),window.router=F;var Ze=F,Xe=$.id("app-banner");Xe&&(Xe.style.display="block");var et={route:"/logout/",element:"div",beforeRender:function(){return Ze.isUserGoingBack("/")?{stopExec:!0}:X.post("/api/logout/",!0,"").then(function(){return F.load("/")})},textContent:"Logging you out"};Ze.registerRoute(et),o()(s.a.mark(function e(){var t,n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[Ee,Pe,Je],n=0;n<t.length;n++)r=t[n],Ze.registerRoute(r);case 2:case"end":return e.stop()}},e,this)}))(),re(Ze,!1).then(function(){return Ze.startLoad()});"serviceWorker"in navigator&&"localhost"!==location.hostname&&Qe.a.register().then(function(e){return console.log("SW registered.",e.scope)})}});